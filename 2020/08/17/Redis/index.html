<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Redis | 灵熙云工作室</title><meta name="robots" content="noindex"><meta name="description" content="Redis概述什么是Redis　　Redis是用C语言开发的一个开源的高性能键值对（key-value）非关系性数据库，官方提供测试数据，50个并发执行100000个请求,读的速度是110000次&#x2F;s,写的速度是81000次&#x2F;s，且Redis通过提供多种键值数据类型来适应不同场景下的存储需求，目前为止Redis支持的键值数据类型如下：   字符串类型 string 散列类型 hash 列表类型 l"><meta name="keywords" content="Redis,缓存"><meta name="author" content="灵熙云,minkeyto@qq.com"><meta name="copyright" content="灵熙云"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/file/favicon.png"><link rel="canonical" href="http://www.goitman.cn/2020/08/17/Redis/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="preconnect" href="//zz.bdstatic.com"/><meta property="og:type" content="article"><meta property="og:title" content="Redis"><meta property="og:url" content="http://www.goitman.cn/2020/08/17/Redis/"><meta property="og:site_name" content="灵熙云工作室"><meta property="og:description" content="Redis概述什么是Redis　　Redis是用C语言开发的一个开源的高性能键值对（key-value）非关系性数据库，官方提供测试数据，50个并发执行100000个请求,读的速度是110000次&#x2F;s,写的速度是81000次&#x2F;s，且Redis通过提供多种键值数据类型来适应不同场景下的存储需求，目前为止Redis支持的键值数据类型如下：   字符串类型 string 散列类型 hash 列表类型 l"><meta property="og:image" content="https://i.loli.net/2020/08/17/YiXeMQRwypSL2h9.jpg"><meta property="article:published_time" content="2020-08-17T03:17:39.048Z"><meta property="article:modified_time" content="2020-08-24T06:55:48.368Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?5c009f46ba6df7bc385f101477536214";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: false,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: true,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false    
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2020-08-24 14:55:48'
}</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><link rel="stylesheet" href="/css/effect.css"><meta name="generator" content="Hexo 4.2.1"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/file/head.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">8</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">24</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">8</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-file"></i><span> 数据库</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/2020/08/17/Redis/"><i class="fa-fw fa fa-book"></i><span> Redis</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-users"></i><span> 友链&amp;留言板</span></a></div></div></div></div><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis概述"><span class="toc-number">1.</span> <span class="toc-text">Redis概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#什么是Redis"><span class="toc-number">1.1.</span> <span class="toc-text">什么是Redis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis的应用场景"><span class="toc-number">1.2.</span> <span class="toc-text">Redis的应用场景</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Window版Redis安装"><span class="toc-number">2.</span> <span class="toc-text">Window版Redis安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis-单机版"><span class="toc-number">2.1.</span> <span class="toc-text">Redis 单机版</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis的安装"><span class="toc-number">2.1.1.</span> <span class="toc-text">Redis的安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis的目录结构"><span class="toc-number">2.1.2.</span> <span class="toc-text">Redis的目录结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis的启动与关闭"><span class="toc-number">2.1.3.</span> <span class="toc-text">Redis的启动与关闭</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis的使用"><span class="toc-number">2.1.4.</span> <span class="toc-text">Redis的使用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis-集群版"><span class="toc-number">2.2.</span> <span class="toc-text">Redis 集群版</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#环境准备"><span class="toc-number">2.2.1.</span> <span class="toc-text">环境准备</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#准备6个实例"><span class="toc-number">2.2.2.</span> <span class="toc-text">准备6个实例</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#配置文件"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">配置文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#安装redis服务"><span class="toc-number">2.2.2.2.</span> <span class="toc-text">安装redis服务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#卸载redis服务"><span class="toc-number">2.2.2.3.</span> <span class="toc-text">卸载redis服务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#启动redis服务"><span class="toc-number">2.2.2.4.</span> <span class="toc-text">启动redis服务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#停止redis服务"><span class="toc-number">2.2.2.5.</span> <span class="toc-text">停止redis服务</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#安装ruby开发环境"><span class="toc-number">2.2.3.</span> <span class="toc-text">安装ruby开发环境</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#安装驱动redis-xxxx-gem"><span class="toc-number">2.2.4.</span> <span class="toc-text">安装驱动redis-xxxx.gem</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用redis-trib-rb创建集群"><span class="toc-number">2.2.5.</span> <span class="toc-text">使用redis-trib.rb创建集群</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Linux版Redis安装"><span class="toc-number">3.</span> <span class="toc-text">Linux版Redis安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis-单机版-1"><span class="toc-number">3.1.</span> <span class="toc-text">Redis 单机版</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#环境准备-1"><span class="toc-number">3.1.1.</span> <span class="toc-text">环境准备</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#安装"><span class="toc-number">3.1.2.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#启动"><span class="toc-number">3.1.3.</span> <span class="toc-text">启动</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#前端启动（不推荐）"><span class="toc-number">3.1.3.1.</span> <span class="toc-text">前端启动（不推荐）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#后台启动"><span class="toc-number">3.1.3.2.</span> <span class="toc-text">后台启动</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#连接"><span class="toc-number">3.1.4.</span> <span class="toc-text">连接</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#使用redis-cli客户端连接"><span class="toc-number">3.1.4.1.</span> <span class="toc-text">使用redis-cli客户端连接</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#图形化界面连接"><span class="toc-number">3.1.4.2.</span> <span class="toc-text">图形化界面连接</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis-集群版-1"><span class="toc-number">3.2.</span> <span class="toc-text">Redis 集群版</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis-集群原理"><span class="toc-number">3.2.1.</span> <span class="toc-text">Redis 集群原理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Redis-cluster-架构图"><span class="toc-number">3.2.1.1.</span> <span class="toc-text">Redis-cluster 架构图</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Redis-cluster-投票-amp-容错"><span class="toc-number">3.2.1.2.</span> <span class="toc-text">Redis-cluster 投票&amp;容错</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis-集群搭建"><span class="toc-number">3.2.2.</span> <span class="toc-text">Redis 集群搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#准备6个实例-1"><span class="toc-number">3.2.2.1.</span> <span class="toc-text">准备6个实例</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#复制实例"><span class="toc-number">3.2.2.1.1.</span> <span class="toc-text">复制实例</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#修改端口号"><span class="toc-number">3.2.2.1.2.</span> <span class="toc-text">修改端口号</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#同时启动6个实例"><span class="toc-number">3.2.2.1.3.</span> <span class="toc-text">同时启动6个实例</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#安装环境"><span class="toc-number">3.2.2.2.</span> <span class="toc-text">安装环境</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#创建redis集群"><span class="toc-number">3.2.2.3.</span> <span class="toc-text">创建redis集群</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#配置集群节点"><span class="toc-number">3.2.2.3.1.</span> <span class="toc-text">配置集群节点</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#集群启动"><span class="toc-number">3.2.2.3.2.</span> <span class="toc-text">集群启动</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis集群连接"><span class="toc-number">3.2.3.</span> <span class="toc-text">Redis集群连接</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#工具连接"><span class="toc-number">3.2.3.1.</span> <span class="toc-text">工具连接</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#代码连接"><span class="toc-number">3.2.3.2.</span> <span class="toc-text">代码连接</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis的通用命令"><span class="toc-number">4.</span> <span class="toc-text">Redis的通用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#连接远程Redis服务器"><span class="toc-number">4.1.</span> <span class="toc-text">连接远程Redis服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#密码设置"><span class="toc-number">4.1.1.</span> <span class="toc-text">密码设置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#keys-pattern"><span class="toc-number">4.2.</span> <span class="toc-text">keys pattern</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#del-key1-key2…"><span class="toc-number">4.3.</span> <span class="toc-text">del key1 key2…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exists-key"><span class="toc-number">4.4.</span> <span class="toc-text">exists key</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#type-key"><span class="toc-number">4.5.</span> <span class="toc-text">type key</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#select-切换数据库"><span class="toc-number">4.6.</span> <span class="toc-text">select 切换数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#move移key到其他数据库"><span class="toc-number">4.7.</span> <span class="toc-text">move移key到其他数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#info-获取-redis-服务器的统计信息"><span class="toc-number">4.8.</span> <span class="toc-text">info 获取 redis 服务器的统计信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Help"><span class="toc-number">4.9.</span> <span class="toc-text">Help</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis的数据类型"><span class="toc-number">5.</span> <span class="toc-text">Redis的数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis的5种数据类型"><span class="toc-number">5.1.</span> <span class="toc-text">Redis的5种数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#字符串类型string"><span class="toc-number">5.2.</span> <span class="toc-text">字符串类型string</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#概述"><span class="toc-number">5.2.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#常用命令"><span class="toc-number">5.2.2.</span> <span class="toc-text">常用命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#哈希类型hash"><span class="toc-number">5.3.</span> <span class="toc-text">哈希类型hash</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#概述-1"><span class="toc-number">5.3.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#常用命令-1"><span class="toc-number">5.3.2.</span> <span class="toc-text">常用命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#列表类型list"><span class="toc-number">5.4.</span> <span class="toc-text">列表类型list</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#概述-2"><span class="toc-number">5.4.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#常用命令-2"><span class="toc-number">5.4.2.</span> <span class="toc-text">常用命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#无序集合set"><span class="toc-number">5.5.</span> <span class="toc-text">无序集合set</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#概述-3"><span class="toc-number">5.5.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#常用命令-3"><span class="toc-number">5.5.2.</span> <span class="toc-text">常用命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#有序集合sorted-set"><span class="toc-number">5.6.</span> <span class="toc-text">有序集合sorted set</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#概述-4"><span class="toc-number">5.6.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#有序集合和列表类型区别："><span class="toc-number">5.6.2.</span> <span class="toc-text">有序集合和列表类型区别：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#常用命令-4"><span class="toc-number">5.6.3.</span> <span class="toc-text">常用命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#总结"><span class="toc-number">5.7.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis的持久化"><span class="toc-number">6.</span> <span class="toc-text">Redis的持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#持久化概述"><span class="toc-number">6.1.</span> <span class="toc-text">持久化概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RDB持久化机制"><span class="toc-number">6.2.</span> <span class="toc-text">RDB持久化机制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#优点"><span class="toc-number">6.2.1.</span> <span class="toc-text">优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#缺点"><span class="toc-number">6.2.2.</span> <span class="toc-text">缺点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#配置"><span class="toc-number">6.2.3.</span> <span class="toc-text">配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOF持久化机制"><span class="toc-number">6.3.</span> <span class="toc-text">AOF持久化机制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#优点-1"><span class="toc-number">6.3.1.</span> <span class="toc-text">优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#缺点-1"><span class="toc-number">6.3.2.</span> <span class="toc-text">缺点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#配置-1"><span class="toc-number">6.3.3.</span> <span class="toc-text">配置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#开启AOF持久化"><span class="toc-number">6.3.3.1.</span> <span class="toc-text">开启AOF持久化</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#AOF持久化时机"><span class="toc-number">6.3.3.2.</span> <span class="toc-text">AOF持久化时机</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Jedis的基本使用"><span class="toc-number">7.</span> <span class="toc-text">Jedis的基本使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#介绍"><span class="toc-number">7.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基本操作"><span class="toc-number">7.2.</span> <span class="toc-text">基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#常用API"><span class="toc-number">7.2.1.</span> <span class="toc-text">常用API</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#代码操作"><span class="toc-number">7.2.2.</span> <span class="toc-text">代码操作</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#连接池的使用"><span class="toc-number">7.3.</span> <span class="toc-text">连接池的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#基本概念"><span class="toc-number">7.3.1.</span> <span class="toc-text">基本概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#常用API-1"><span class="toc-number">7.3.2.</span> <span class="toc-text">常用API</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#代码操作-1"><span class="toc-number">7.3.3.</span> <span class="toc-text">代码操作</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#连接池工具类"><span class="toc-number">7.4.</span> <span class="toc-text">连接池工具类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#配置文件-1"><span class="toc-number">7.4.1.</span> <span class="toc-text">配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#工具类"><span class="toc-number">7.4.2.</span> <span class="toc-text">工具类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#测试代码"><span class="toc-number">7.4.3.</span> <span class="toc-text">测试代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#过期与淘汰策略"><span class="toc-number">8.</span> <span class="toc-text">过期与淘汰策略</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#设置占用内存"><span class="toc-number">8.1.</span> <span class="toc-text">设置占用内存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#过期策略"><span class="toc-number">8.2.</span> <span class="toc-text">过期策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#淘汰策略"><span class="toc-number">8.3.</span> <span class="toc-text">淘汰策略</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#配置文件设置"><span class="toc-number">8.3.1.</span> <span class="toc-text">配置文件设置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#命令修改"><span class="toc-number">8.3.2.</span> <span class="toc-text">命令修改</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LRU算法"><span class="toc-number">8.3.3.</span> <span class="toc-text">LRU算法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#在Redis中的实现"><span class="toc-number">8.3.3.1.</span> <span class="toc-text">在Redis中的实现</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#近似LRU算法"><span class="toc-number">8.3.3.1.1.</span> <span class="toc-text">近似LRU算法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Redis3-0的优化"><span class="toc-number">8.3.3.1.2.</span> <span class="toc-text">Redis3.0的优化</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LFU算法"><span class="toc-number">8.3.4.</span> <span class="toc-text">LFU算法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LRU与LFU的区别"><span class="toc-number">8.3.5.</span> <span class="toc-text">LRU与LFU的区别</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://i.loli.net/2020/08/17/YiXeMQRwypSL2h9.jpg)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">灵熙云工作室</a></span><span class="pull-right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-file"></i><span> 数据库</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/2020/08/17/Redis/"><i class="fa-fw fa fa-book"></i><span> Redis</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-users"></i><span> 友链&amp;留言板</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">Redis</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-08-17 11:17:39"><i class="far fa-calendar-alt fa-fw"></i> 发表于 2020-08-17</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-08-24 14:55:48"><i class="fas fa-history fa-fw"></i> 更新于 2020-08-24</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fas fa-inbox fa-fw post-meta__icon"></i><a class="post-meta__categories" href="/categories/%E7%BC%93%E5%AD%98%E6%95%B0%E6%8D%AE%E5%BA%93/">缓存数据库</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta__icon"></i><span>字数总计:</span><span class="word-count">11.8k</span><span class="post-meta__separator">|</span><i class="far fa-clock fa-fw post-meta__icon"></i><span>阅读时长: 46 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="far fa-eye fa-fw post-meta__icon"></i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span><span class="post-meta__separator">|</span><i class="far fa-comments fa-fw post-meta__icon"></i><span>评论数:</span><a href="/2020/08/17/Redis/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/2020/08/17/Redis/" itemprop="commentCount"></span></a></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h2 id="Redis概述"><a href="#Redis概述" class="headerlink" title="Redis概述"></a>Redis概述</h2><h3 id="什么是Redis"><a href="#什么是Redis" class="headerlink" title="什么是Redis"></a>什么是Redis</h3><p>　　Redis是用C语言开发的一个开源的高性能键值对（key-value）非关系性数据库，官方提供测试数据，50个并发执行100000个请求,读的速度是110000次/s,写的速度是81000次/s，且Redis通过提供多种键值数据类型来适应不同场景下的存储需求，目前为止Redis支持的键值数据类型如下：</p>
<blockquote>
<ol>
<li>字符串类型 string</li>
<li>散列类型 hash</li>
<li>列表类型 list</li>
<li>集合类型 set</li>
<li>有序集合类型 sortedset</li>
</ol>
</blockquote>
<h3 id="Redis的应用场景"><a href="#Redis的应用场景" class="headerlink" title="Redis的应用场景"></a>Redis的应用场景</h3><blockquote>
<ol>
<li>缓存（数据查询、短连接、新闻内容、商品内容等等）</li>
<li>聊天室的在线好友列表</li>
<li>任务队列。（秒杀、抢购、12306等等）</li>
<li>应用排行榜</li>
<li>网站访问统计</li>
<li>数据过期处理（可以精确到毫秒</li>
<li>分布式集群架构中的session分离</li>
</ol>
</blockquote>
<p>　　总结，只要希望查询快就可以使用redis，但是mysql中的数据如果频繁的更新，就不建议使用redis了，否则redis会频繁的从mysql不断更新数据，会导致redis慢了。<font face="微软雅黑" color=red size=3>redis适合存储经常查询又不经常更新的数据。</font>　（更新的频率不要太高。）
　　</p>
<h2 id="Window版Redis安装"><a href="#Window版Redis安装" class="headerlink" title="Window版Redis安装"></a>Window版Redis安装</h2><p>从GitHub上下载window版的Redis（本文使用Redis-x64-3.2.100版本），下载地址：</p>
<blockquote>
<p><a href="https://github.com/MSOpenTech/redis/tags" target="_blank" rel="noopener">https://github.com/MSOpenTech/redis/tags</a></p>
</blockquote>
<h3 id="Redis-单机版"><a href="#Redis-单机版" class="headerlink" title="Redis 单机版"></a>Redis 单机版</h3><h4 id="Redis的安装"><a href="#Redis的安装" class="headerlink" title="Redis的安装"></a>Redis的安装</h4><p>window版的安装及其简单，解压Redis压缩包即可</p>
<h4 id="Redis的目录结构"><a href="#Redis的目录结构" class="headerlink" title="Redis的目录结构"></a>Redis的目录结构</h4><p>解压Redis压缩包后，见到如下目录机构：<br><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/14/rlCWPm3OVGipa4q.png" alt=""></p>
<h4 id="Redis的启动与关闭"><a href="#Redis的启动与关闭" class="headerlink" title="Redis的启动与关闭"></a>Redis的启动与关闭</h4><p>双击Redis目录中redis-server.exe可以启动redis服务，Redis服务占用的端口是6379</p>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/12/gHSqRls8nfYQVCE.png" alt="14.png"></p>
<p>关闭Redis的控制台窗口就可以关闭Redis服务</p>
<h4 id="Redis的使用"><a href="#Redis的使用" class="headerlink" title="Redis的使用"></a>Redis的使用</h4><p>双击Redis目录中redis-cli.exe可以启动redis客户端</p>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/12/dXZ6vB1owNSzFEj.png" alt="15.png"></p>
<p><font face="微软雅黑" color=red size=3>注意事项：redis所在的硬盘位置的盘符，硬盘空间必须有20G以上。redis解压到非中文目录里面，目录结构不要太深。</font>
　</p>
<h3 id="Redis-集群版"><a href="#Redis-集群版" class="headerlink" title="Redis 集群版"></a>Redis 集群版</h3><h4 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h4><p>使用redis-trib.rb工具创建Redis集群，由于该文件是用ruby语言写的，所以需要安装Ruby开发环境，以及驱动redis-xxxx.gem，所以除了Redis安装文件外，还需要下载如上所述三个文件：</p>
<p>1、脚本文件redis-trib.rb，下载地址：</p>
<blockquote>
<p><a href="https://github.com/beebol/redis-trib.rb" target="_blank" rel="noopener">https://github.com/beebol/redis-trib.rb</a></p>
</blockquote>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/12/kEFB4DsipoUTIbw.png" alt=""></p>
<p>2、开发环境Ruby（本文使用rubyinstaller-2.2.4-x64.exe安装版），下载地址：</p>
<blockquote>
<p><a href="http://dl.bintray.com/oneclick/rubyinstaller/" target="_blank" rel="noopener">http://dl.bintray.com/oneclick/rubyinstaller/</a></p>
</blockquote>
<p>3、驱动redis-xxxx.gem（本文使用3.2.2版本），下载地址：</p>
<blockquote>
<p><a href="https://rubygems.org/gems/redis/versions" target="_blank" rel="noopener">https://rubygems.org/gems/redis/versions</a></p>
</blockquote>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/12/O8CvrSjLexUB2tq.png" alt=""></p>
<h4 id="准备6个实例"><a href="#准备6个实例" class="headerlink" title="准备6个实例"></a>准备6个实例</h4><h5 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h5><p>在Redis安装根目录下，创建编码格式为utf-8的配置文件：redis.6380.conf、redis.6381.conf、redis.6382.conf、redis.6383.conf、redis.6384.conf、redis.6385.conf。（Redis默认端口为6379，这里使用6380-6385六个端口）</p>
<p>以redis.6380.conf为例：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">port 6380      </span><br><span class="line">loglevel notice    </span><br><span class="line">logfile <span class="string">"E:/Redis-Cluster/Redis-x64-3.2.100/Logs/redis6380_log.txt"</span>       </span><br><span class="line">appendonly yes</span><br><span class="line">appendfilename <span class="string">"appendonly.6380.aof"</span>   </span><br><span class="line">cluster-enabled yes                                    </span><br><span class="line">cluster-config-file nodes.6380.conf</span><br><span class="line">cluster-node-timeout 15000</span><br><span class="line">cluster-slave-validity-factor 10</span><br><span class="line">cluster-migration-barrier 1</span><br><span class="line">cluster-require-full-coverage yes</span><br></pre></td></tr></table></figure>

<p><font face="微软雅黑" color=red size=3>备注：<br>1、其他配置文件只需将port、logfile、appendfilename、cluster-config-file中的6380修改为相应的端口号即可<br>2、loglevel：日志的记录级别，notice是适合生产环境的<br>3、logfile：指定log的保存路径（默认是创建在Redis安装目录下），此处手动创建Logs目录<br>4、appendonly：持久化模式为aof格式<br>5、appendfilename：持久化文件<br>6、cluster-config-file：节点配置文件<br>7、cluster-enabled：是否开启集群<br></font>　</p>
<h5 id="安装redis服务"><a href="#安装redis服务" class="headerlink" title="安装redis服务"></a>安装redis服务</h5><p><font face="微软雅黑" color=red size=3>使用完整路径，避免集群出现问题</font>　</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">E:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-install E:/Redis-Cluster/Redis-x64-3.2.100/redis.6380.conf --service-name redis6380</span><br><span class="line">E:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-install E:/Redis-Cluster/Redis-x64-3.2.100/redis.6381.conf --service-name redis6381</span><br><span class="line">E:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-install E:/Redis-Cluster/Redis-x64-3.2.100/redis.6382.conf --service-name redis6382</span><br><span class="line">E:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-install E:/Redis-Cluster/Redis-x64-3.2.100/redis.6383.conf --service-name redis6383</span><br><span class="line">E:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-install E:/Redis-Cluster/Redis-x64-3.2.100/redis.6384.conf --service-name redis6384</span><br><span class="line">E:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-install E:/Redis-Cluster/Redis-x64-3.2.100/redis.6385.conf --service-name redis6385</span><br></pre></td></tr></table></figure>

<h5 id="卸载redis服务"><a href="#卸载redis服务" class="headerlink" title="卸载redis服务"></a>卸载redis服务</h5><p>只需把安装命令中的–service-install修改为–service-uninstall即可，如下</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">E:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-uninstall E:/Redis-Cluster/Redis-x64-3.2.100/redis.6380.conf --service-name redis6380</span><br></pre></td></tr></table></figure>


<h5 id="启动redis服务"><a href="#启动redis服务" class="headerlink" title="启动redis服务"></a>启动redis服务</h5><p><font face="微软雅黑" color=red size=3>使用完整路径，避免集群出现问题</font>　</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">E:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-start --service-name redis6380</span><br><span class="line">E:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-start --service-name redis6381</span><br><span class="line">E:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-start --service-name redis6382</span><br><span class="line">E:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-start --service-name redis6383</span><br><span class="line">E:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-start --service-name redis6384</span><br><span class="line">E:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-start --service-name redis6385</span><br></pre></td></tr></table></figure>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/14/fFJlM5ZpQo8kymg.png" alt=""></p>
<p><font face="微软雅黑" color=red size=3>注：如果服务状态在正在运行时执行了卸载命令，这时服务窗口的Redis服务还是会显示，只有当服务停止后才不会再显示</font></p>
<h5 id="停止redis服务"><a href="#停止redis服务" class="headerlink" title="停止redis服务"></a>停止redis服务</h5><p>只需把安装命令中的–service-start修改为–service-stop即可，如下</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">E:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-stop --service-name redis6380</span><br></pre></td></tr></table></figure>

<h4 id="安装ruby开发环境"><a href="#安装ruby开发环境" class="headerlink" title="安装ruby开发环境"></a>安装ruby开发环境</h4><p>双击rubyinstaller-2.2.4-x64.exe，选中如图两个选项（意义为将ruby添加到系统环境变量中，在cmd命令中能直接使用ruby命令），之后就是傻瓜式安装啦<br><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/14/VcChtk7JTrdsjF6.png" alt=""></p>
<h4 id="安装驱动redis-xxxx-gem"><a href="#安装驱动redis-xxxx-gem" class="headerlink" title="安装驱动redis-xxxx.gem"></a>安装驱动redis-xxxx.gem</h4><p>将驱动redis-xxxx.gem拷贝到Ruby安装根目录下，在此目录执行cmd命令安装</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gem install --<span class="built_in">local</span> path_to_gem/filename.gem</span><br></pre></td></tr></table></figure>

<h4 id="使用redis-trib-rb创建集群"><a href="#使用redis-trib-rb创建集群" class="headerlink" title="使用redis-trib.rb创建集群"></a>使用redis-trib.rb创建集群</h4><p>将redis-trib.rb文件拷贝到Redis安装目录下，在此目录执行cmd命令创建集群</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">D:/Redis-Cluster/Redis-x64-3.2.100/redis-trib.rb create --replicas 1 127.0.0.1:6380 127.0.0.1:6381 127.0.0.1:6382 127.0.0.1:6383 127.0.0.1:6384 127.0.0.1:6385</span><br></pre></td></tr></table></figure>

<p>启动信息（中间会提示是否设置配置，输入yes）,每个主节点分配的哈希槽信息和主从分配信息在此都可查看</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; Creating cluster</span><br><span class="line">Connecting to node 127.0.0.1:6380: OK</span><br><span class="line">Connecting to node 127.0.0.1:6381: OK</span><br><span class="line">Connecting to node 127.0.0.1:6382: OK</span><br><span class="line">Connecting to node 127.0.0.1:6383: OK</span><br><span class="line">Connecting to node 127.0.0.1:6384: OK</span><br><span class="line">Connecting to node 127.0.0.1:6385: OK</span><br><span class="line">&gt;&gt;&gt; Performing <span class="built_in">hash</span> slots allocation on 6 nodes...</span><br><span class="line">Using 3 masters:</span><br><span class="line">127.0.0.1:6380</span><br><span class="line">127.0.0.1:6381</span><br><span class="line">127.0.0.1:6382</span><br><span class="line">Adding replica 127.0.0.1:6383 to 127.0.0.1:6380</span><br><span class="line">Adding replica 127.0.0.1:6384 to 127.0.0.1:6381</span><br><span class="line">Adding replica 127.0.0.1:6385 to 127.0.0.1:6382</span><br><span class="line">M: bb6ef615bb0ae13275943caec0db9d30b9f35c5e 127.0.0.1:6380   slots:0-5460      (5461 slots) master</span><br><span class="line">M: b4d120f2983ad683f7b68992e1ba414722238db7 127.0.0.1:6381   slots:5461-10922  (5462 slots) master</span><br><span class="line">M: 837779b3965e2c9d4dd4385750aaaaf9a9039fb0 127.0.0.1:6382   slots:10923-16383 (5461 slots) master</span><br><span class="line">S: 5d154137180284d926ef51a91fc75f9438249ef8 127.0.0.1:6383   replicates bb6ef615bb0ae13275943caec0db9d30b9f35c5e</span><br><span class="line">S: ad151680a3e36cf2083ef822be0bdb075a7d36de 127.0.0.1:6384   replicates b4d120f2983ad683f7b68992e1ba414722238db7</span><br><span class="line">S: 9a2260a5a6a2add84b622a453a6a7b86a29d180d 127.0.0.1:6385   replicates 837779b3965e2c9d4dd4385750aaaaf9a9039fb0</span><br><span class="line">Can I <span class="built_in">set</span> the above configuration? (<span class="built_in">type</span> <span class="string">'yes'</span> to accept): yes</span><br><span class="line">&gt;&gt;&gt; Nodes configuration updated</span><br><span class="line">&gt;&gt;&gt; Assign a different config epoch to each node</span><br><span class="line">&gt;&gt;&gt; Sending CLUSTER MEET messages to join the cluster</span><br><span class="line">Waiting <span class="keyword">for</span> the cluster to join...</span><br><span class="line">&gt;&gt;&gt; Performing Cluster Check (using node 127.0.0.1:6380)M: bb6ef615bb0ae13275943caec0db9d30b9f35c5e 127.0.0.1:6380   slots:0-5460      (5461 slots) master</span><br><span class="line">M: b4d120f2983ad683f7b68992e1ba414722238db7 127.0.0.1:6381   slots:5461-10922  (5462 slots) master</span><br><span class="line">M: 837779b3965e2c9d4dd4385750aaaaf9a9039fb0 127.0.0.1:6382   slots:10923-16383 (5461 slots) master</span><br><span class="line">M: 5d154137180284d926ef51a91fc75f9438249ef8 127.0.0.1:6383   slots:            (0 slots)    master   replicates bb6ef615bb0ae13275943caec0db9d30b9f35c5e</span><br><span class="line">M: ad151680a3e36cf2083ef822be0bdb075a7d36de 127.0.0.1:6384   slots:            (0 slots)    master   replicates b4d120f2983ad683f7b68992e1ba414722238db7</span><br><span class="line">M: 9a2260a5a6a2add84b622a453a6a7b86a29d180d 127.0.0.1:6385   slots:            (0 slots)    master   replicates 837779b3965e2c9d4dd4385750aaaaf9a9039fb0</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line">&gt;&gt;&gt; Check <span class="keyword">for</span> open slots...</span><br><span class="line">&gt;&gt;&gt; Check slots coverage...</span><br><span class="line">[OK] All 16384 slots covered.</span><br></pre></td></tr></table></figure>
<font face="微软雅黑" color=red size=3>
备注：

<p>1、./redis-trib.rb create –replicas X</p>
<blockquote>
<p>X：指定集群中每个主节点配备几个从节点，这里设置为1。</p>
</blockquote>
<p>2、redis-trib.rb工具的使用</p>
<blockquote>
<p>create：创建集群<br>check：检查集群<br>info：查看集群信息<br>fix：修复集群<br>reshard：在线迁移slot<br>rebalance：平衡集群节点slot数量<br>add-node：将新节点加入集群<br>del-node：从集群中删除节点<br>set-timeout：设置集群节点间心跳连接的超时时间<br>call：在集群全部节点上执行命令<br>import：将外部redis数据导入集群<br></font></p>
</blockquote>
<h2 id="Linux版Redis安装"><a href="#Linux版Redis安装" class="headerlink" title="Linux版Redis安装"></a>Linux版Redis安装</h2><p>官网提供了Linux版的Redis下载，官网下载地址：</p>
<blockquote>
<p><a href="http://redis.io/download" target="_blank" rel="noopener">http://redis.io/download</a></p>
</blockquote>
<h3 id="Redis-单机版-1"><a href="#Redis-单机版-1" class="headerlink" title="Redis 单机版"></a>Redis 单机版</h3><h4 id="环境准备-1"><a href="#环境准备-1" class="headerlink" title="环境准备"></a>环境准备</h4><p>Linux：CentOS7<br>Jdk:1.7以上版本</p>
<p>Redis安装在Linux上，redis是c语言开发的，需要gcc-c++环境。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum -y install cpp binutils glibc glibc-kernheaders glibc-common glibc-devel gcc make gcc-c++ libstdc++-devel tcl</span><br></pre></td></tr></table></figure>
<p>如果安装过则不会执行（没有规则可以创建目标“gcc-c++”。 停止）</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">make gcc-c++ libstdc++-devel tcl</span><br></pre></td></tr></table></figure>

<h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p>在安装之前可以先查看是否已经启动了redis，ps –ef | grep redis，再使用kill关闭redis</p>
<p>删除已经安装的redis</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/redis &amp;&amp; rm –rf bin</span><br></pre></td></tr></table></figure>

<p>进入root目录，上传压缩包</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/software</span><br></pre></td></tr></table></figure>

<p>使用工具上传“redis-3.2.4.tar.gz”</p>
<p>解压安装包并进入解压的文件夹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar -zxvf redis-3.2.4.tar.gz &amp;&amp; <span class="built_in">cd</span> redis-3.2.4</span><br></pre></td></tr></table></figure>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/07/plYGuFkDwUhQNrm.png" alt="1.png"></p>
<p>执行安装，指定安装路径 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">make install PREFIX=/usr/<span class="built_in">local</span>/redis</span><br></pre></td></tr></table></figure>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/07/oVB72dFcGXmxWSA.png" alt="2.png"></p>
<p>查看安装目录</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/redis/bin/</span><br></pre></td></tr></table></figure>


<p><font face="微软雅黑" color=red size=3>【说明】常用的是客户端和服务端；redis-cli 是客户端；redis-server 是服务端</font></p>
<h4 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h4><h5 id="前端启动（不推荐）"><a href="#前端启动（不推荐）" class="headerlink" title="前端启动（不推荐）"></a>前端启动（不推荐）</h5><p>前端启动</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./redis-server</span><br></pre></td></tr></table></figure>

<p>确认redis安装正常，效果：<br><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/07/lhqSERpC2gTa8VL.png" alt="3.png"></p>
<h5 id="后台启动"><a href="#后台启动" class="headerlink" title="后台启动"></a>后台启动</h5><p>从安装包中复制redis.conf文件到/usr/local/redis/bin中</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cp /root/software/redis-3.2.4/redis.conf ./</span><br></pre></td></tr></table></figure>

<p>修改redis.conf配置文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vi redis.conf</span><br></pre></td></tr></table></figure>

<p>设置后台启动redis，修改如下，默认为no</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">daemonize yes</span><br></pre></td></tr></table></figure>

<p>设置不仅限制本地访问：<br>注释掉 bind 127.0.0.1</p>
<p>禁用保护模式：<br>把 protected-mode yes 改为 protected-mode no </p>
<p><font face="微软雅黑" color=red size=3>【提示】vim打开文件中查找内容的方式为底行模式按 /，然后输入要查找的内容即可(shift + n下一个)。如果被选中了后不想被选中则可以随意输入查找来消除选中效果</font></p>
<p>启动</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./redis-server redis.conf</span><br></pre></td></tr></table></figure>

<p>查看启动</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ps -ef | grep redis</span><br></pre></td></tr></table></figure>

<h4 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h4><h5 id="使用redis-cli客户端连接"><a href="#使用redis-cli客户端连接" class="headerlink" title="使用redis-cli客户端连接"></a>使用redis-cli客户端连接</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./redis-cli</span><br></pre></td></tr></table></figure>
<p>如：输入ping ,返回pong<br><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/07/I7PNXcTW3H5EjQl.png" alt="4.png"></p>
<h5 id="图形化界面连接"><a href="#图形化界面连接" class="headerlink" title="图形化界面连接"></a>图形化界面连接</h5><p>使用图形化界面测试访问192.168.12.168，redis默认端口为6379；示例图工具是Redis Desktop Manager</p>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/07/BJpFs5SRfqT8lNQ.png" alt="5.png"></p>
<h3 id="Redis-集群版-1"><a href="#Redis-集群版-1" class="headerlink" title="Redis 集群版"></a>Redis 集群版</h3><h4 id="Redis-集群原理"><a href="#Redis-集群原理" class="headerlink" title="Redis 集群原理"></a>Redis 集群原理</h4><h5 id="Redis-cluster-架构图"><a href="#Redis-cluster-架构图" class="headerlink" title="Redis-cluster 架构图"></a>Redis-cluster 架构图</h5><p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/12/EuLxirCWPAKfcjR.png" alt="6.png"></p>
<blockquote>
<ol>
<li>所有的 redis 节点彼此互联(PING-PONG 机制),内部使用二进制协议优化传输速度和带宽。</li>
<li>节点的 fail 是通过集群中超过半数的节点检测失效时才生效。</li>
<li>客户端与 redis 节点直连,不需要中间 proxy 层。客户端不需要连接集群所有节点,连接集群中任何一个可用节点即可。</li>
<li>redis-cluster 把所有的物理节点映射到[0-16383]slot 上,cluster 负责维护node&lt;-&gt;slot&lt;-&gt;value</li>
</ol>
</blockquote>
<p>Redis 集群中内置了 16384 个哈希槽，当需要在 Redis 集群中放置一个 key-value 时， redis 先对 key 使用 crc16 算法算出一个结果，然后把结果对 16384求余数，这样每个 key 都会对应一个编号在 0-16383 之间的哈希槽， redis 会根据节点数量大致均等的将哈希槽映射到不同的节点。</p>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/12/FhUgiO9N7C3A4uM.png" alt="7.png"></p>
<h5 id="Redis-cluster-投票-amp-容错"><a href="#Redis-cluster-投票-amp-容错" class="headerlink" title="Redis-cluster 投票&amp;容错"></a>Redis-cluster 投票&amp;容错</h5><p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/12/TGougK6rNeSvbZx.png" alt="8.png"><br>投票过程是集群中所有 master 参与,如果半数以上 master 节点与 master 节点通信超时(cluster-node-timeout),认为当前 master 节点挂掉.</p>
<p>什么时候整个集群不可用(cluster_state:fail)?</p>
<blockquote>
<ol>
<li>如果集群任意 master 挂掉,且当前 master 没有 slave.集群进入 fail 状态,也可以理解成集群的 slot 映射[0-16383]不完整时进入 fail 状态. ps : redis-3.0.0.rc1 加入 cluster-require-full-coverage 参数,默认关闭,打开集群兼容部分失败.</li>
<li>如果集群超过半数以上 master 挂掉，无论是否有 slave，集群进入 fail 状态.</li>
</ol>
</blockquote>
<h4 id="Redis-集群搭建"><a href="#Redis-集群搭建" class="headerlink" title="Redis 集群搭建"></a>Redis 集群搭建</h4><h5 id="准备6个实例-1"><a href="#准备6个实例-1" class="headerlink" title="准备6个实例"></a>准备6个实例</h5><p>为了保证可以进行投票，至少需要3个主节点。每个主节点都需要至少一个从节点,所以需要至少3个从节点。<br>一共需要6台redis服务器；可以使用6个redis实例。6个redis实例的端口号：7001~7006</p>
<h6 id="复制实例"><a href="#复制实例" class="headerlink" title="复制实例"></a>复制实例</h6><p>如果有安装过单机版，那么先停止单机版redis；如果有安装过集群版，那么先停止集群版redis；使用命令找出当前的所有redis进程，然后kill</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./redis-cli shutdown</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ps -ef | grep redis</span><br><span class="line"><span class="built_in">kill</span> 进程号 进程号 ...</span><br></pre></td></tr></table></figure>

<p>把bin目录里面的rdb,和aof文件删除,准备干净的redis</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/redis/bin</span><br><span class="line">rm -rf appendonly.aof </span><br><span class="line">rm -f dump.rdb</span><br></pre></td></tr></table></figure>

<p>把bin复制6份</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> ..</span><br></pre></td></tr></table></figure>

<p>删除原有的redis-cluster</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rm –rf redis-cluster</span><br></pre></td></tr></table></figure>

<p>创建redis-cluster目录</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkdir redis-cluster</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cp -r bin redis-cluster/redis1 &amp;&amp; cp -r bin redis-cluster/redis2 &amp;&amp; cp -r bin redis-cluster/redis3</span><br><span class="line">cp -r bin redis-cluster/redis4 &amp;&amp; cp -r bin redis-cluster/redis5 &amp;&amp; cp -r bin redis-cluster/redis6</span><br></pre></td></tr></table></figure>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/12/7SiIeH1ZGoRhDsm.png" alt="9.png"></p>
<h6 id="修改端口号"><a href="#修改端口号" class="headerlink" title="修改端口号"></a>修改端口号</h6><p>依次修改端口号为7001~7006</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> redis1</span><br><span class="line">vi redis.conf</span><br></pre></td></tr></table></figure>
<p>修改第84行，端口6379为7001，其它5个一样修改<br><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/12/ViombEHJu7Q2T4M.png" alt="10.png"></p>
<h6 id="同时启动6个实例"><a href="#同时启动6个实例" class="headerlink" title="同时启动6个实例"></a>同时启动6个实例</h6><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/redis/redis-cluster</span><br></pre></td></tr></table></figure>
<p>编写启动脚本</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vi start-all.sh</span><br></pre></td></tr></table></figure>
<p>在文件中输入如下内容：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> redis1</span><br><span class="line">./redis-server redis.conf</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"><span class="built_in">cd</span> redis2</span><br><span class="line">./redis-server redis.conf</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"><span class="built_in">cd</span> redis3</span><br><span class="line">./redis-server redis.conf</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"><span class="built_in">cd</span> redis4</span><br><span class="line">./redis-server redis.conf</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"><span class="built_in">cd</span> redis5</span><br><span class="line">./redis-server redis.conf</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"><span class="built_in">cd</span> redis6</span><br><span class="line">./redis-server redis.conf</span><br><span class="line"><span class="built_in">cd</span> ..</span><br></pre></td></tr></table></figure>
<p>设置脚本启动权限</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">chmod u+x start-all.sh</span><br></pre></td></tr></table></figure>
<p>执行脚本；启动6个实例</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./start-all.sh</span><br></pre></td></tr></table></figure>

<p>查看</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ps -ef | grep redis</span><br></pre></td></tr></table></figure>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/12/qmeUaoP1cVIn8t6.png" alt="11.png"></p>
<p>停止6个redis</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ps -ef | grep redis</span><br><span class="line"><span class="built_in">kill</span> 进程号 进程号 ...</span><br></pre></td></tr></table></figure>

<h5 id="安装环境"><a href="#安装环境" class="headerlink" title="安装环境"></a>安装环境</h5><p>redis集群的管理工具使用的是ruby脚本语言，安装集群需要ruby环境。<br>安装ruby环境</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install ruby</span><br></pre></td></tr></table></figure>
<p>安装Ruby的打包系统</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install rubygems</span><br></pre></td></tr></table></figure>
<p>上传redis的ruby接口库</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/software</span><br></pre></td></tr></table></figure>
<p>使用工具上传“redis-3.2.1.gem”到“/root/software”</p>
<p>安装redis的ruby接口库</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gem install redis-3.2.1.gem</span><br></pre></td></tr></table></figure>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/12/26yFisgYa9OPMXl.png" alt="12.png"></p>
<h5 id="创建redis集群"><a href="#创建redis集群" class="headerlink" title="创建redis集群"></a>创建redis集群</h5><h6 id="配置集群节点"><a href="#配置集群节点" class="headerlink" title="配置集群节点"></a>配置集群节点</h6><p>需要修改每个实例的redis.conf配置文件,开启redis-cluster</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/redis/redis-cluster/</span><br><span class="line">vi redis1/redis.conf</span><br></pre></td></tr></table></figure>
<p>反注释第721行，同样需要修改6个节点；</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cluster-enabled yes</span><br></pre></td></tr></table></figure>

<p>重启redis实例</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./start-all.sh</span><br></pre></td></tr></table></figure>
<h6 id="集群启动"><a href="#集群启动" class="headerlink" title="集群启动"></a>集群启动</h6><p>集群管理工具redis-trib.rb在redis解压文件夹的src的文件夹中；使用redis-cluster的集群管理工具启动集群。<br>先进入集群管理工具所在的路径</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/software/redis-3.2.4/src/</span><br></pre></td></tr></table></figure>
<p>再启动命令（注意如下连接中的ip最好不用127.0.0.1和默认端口）</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./redis-trib.rb create --replicas 1 192.168.12.168:7001 192.168.12.168:7002 192.168.12.168:7003 192.168.12.168:7004 192.168.12.168:7005 192.168.12.168:7006</span><br></pre></td></tr></table></figure>
<font face="微软雅黑" color=red size=3>
备注：

<p>1、./redis-trib.rb create –replicas X</p>
<blockquote>
<p>X：指定集群中每个主节点配备几个从节点，这里设置为1。</p>
</blockquote>
<p>2、redis-trib.rb工具的使用</p>
<blockquote>
<p>create：创建集群<br>check：检查集群<br>info：查看集群信息<br>fix：修复集群<br>reshard：在线迁移slot<br>rebalance：平衡集群节点slot数量<br>add-node：将新节点加入集群<br>del-node：从集群中删除节点<br>set-timeout：设置集群节点间心跳连接的超时时间<br>call：在集群全部节点上执行命令<br>import：将外部redis数据导入集群<br></font></p>
</blockquote>
<p>启动信息（中间会提示是否设置配置，输入yes）,每个主节点分配的哈希槽信息和主从分配信息在此都可查看</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; Creating cluster</span><br><span class="line">&gt;&gt;&gt; Performing <span class="built_in">hash</span> slots allocation on 6 nodes...</span><br><span class="line">Using 3 masters:</span><br><span class="line">192.168.12.168:7001</span><br><span class="line">192.168.12.168:7002</span><br><span class="line">192.168.12.168:7003</span><br><span class="line">Adding replica 192.168.12.168:7004 to 192.168.12.168:7001</span><br><span class="line">Adding replica 192.168.12.168:7005 to 192.168.12.168:7002</span><br><span class="line">Adding replica 192.168.12.168:7006 to 192.168.12.168:7003</span><br><span class="line">M: 28b8be6f285e363a957a275143dc6c5a16640d27 192.168.12.168:7001</span><br><span class="line">   slots:0-5460 (5461 slots) master</span><br><span class="line">M: b1157115d9b1f5b15939d13cd01f447423acd3e6 192.168.12.168:7002</span><br><span class="line">   slots:5461-10922 (5462 slots) master</span><br><span class="line">M: 1826fa69c51853431725f156dbe902958e96a564 192.168.12.168:7003</span><br><span class="line">   slots:10923-16383 (5461 slots) master</span><br><span class="line">S: 201c1643327b7cf07039f14e95383edade027316 192.168.12.168:7004</span><br><span class="line">   replicates 28b8be6f285e363a957a275143dc6c5a16640d27</span><br><span class="line">S: a49bb2d84beb4d531345f6b92561454458908a41 192.168.12.168:7005</span><br><span class="line">   replicates b1157115d9b1f5b15939d13cd01f447423acd3e6</span><br><span class="line">S: 9dad6428a9f199c0ffd5a0a9b3de1853dec1ca1a 192.168.12.168:7006</span><br><span class="line">   replicates 1826fa69c51853431725f156dbe902958e96a564</span><br><span class="line">Can I <span class="built_in">set</span> the above configuration? (<span class="built_in">type</span> <span class="string">'yes'</span> to accept): yes</span><br><span class="line">&gt;&gt;&gt; Nodes configuration updated</span><br><span class="line">&gt;&gt;&gt; Assign a different config epoch to each node</span><br><span class="line">&gt;&gt;&gt; Sending CLUSTER MEET messages to join the cluster</span><br><span class="line">Waiting <span class="keyword">for</span> the cluster to join...</span><br><span class="line">&gt;&gt;&gt; Performing Cluster Check (using node 192.168.12.168:7001)</span><br><span class="line">M: 28b8be6f285e363a957a275143dc6c5a16640d27 192.168.12.168:7001</span><br><span class="line">   slots:0-5460 (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 1826fa69c51853431725f156dbe902958e96a564 192.168.12.168:7003</span><br><span class="line">   slots:10923-16383 (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: b1157115d9b1f5b15939d13cd01f447423acd3e6 192.168.12.168:7002</span><br><span class="line">   slots:5461-10922 (5462 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 9dad6428a9f199c0ffd5a0a9b3de1853dec1ca1a 192.168.12.168:7006</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 1826fa69c51853431725f156dbe902958e96a564</span><br><span class="line">S: a49bb2d84beb4d531345f6b92561454458908a41 192.168.12.168:7005</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates b1157115d9b1f5b15939d13cd01f447423acd3e6</span><br><span class="line">S: 201c1643327b7cf07039f14e95383edade027316 192.168.12.168:7004</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 28b8be6f285e363a957a275143dc6c5a16640d27</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line">&gt;&gt;&gt; Check <span class="keyword">for</span> open slots...</span><br><span class="line">&gt;&gt;&gt; Check slots coverage...</span><br><span class="line">[OK] All 16384 slots covered.</span><br></pre></td></tr></table></figure>

<h4 id="Redis集群连接"><a href="#Redis集群连接" class="headerlink" title="Redis集群连接"></a>Redis集群连接</h4><h5 id="工具连接"><a href="#工具连接" class="headerlink" title="工具连接"></a>工具连接</h5><p>redis的单机版，默认是16个数据库，但是redis-Cluster集群版，有多少个主节点，就有多少个数据库（整个集群才是一个完整的数据库）。<br>1、使用redis命令行客户端连接</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/redis/bin</span><br><span class="line">./redis-cli -h 192.168.12.168 -p 7006 -c</span><br></pre></td></tr></table></figure>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/12/eosavtlprEIbM84.png" alt="13.png"></p>
<p>【注意】一定要加-c参数,节点之间则可以互相跳转</p>
<p>2、使用图形客户端连接<br>因为有3台主redis数据库，所以需要连接3台。</p>
<h5 id="代码连接"><a href="#代码连接" class="headerlink" title="代码连接"></a>代码连接</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisClusterTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		<span class="comment">// 设置集群节点</span></span><br><span class="line">		Set&lt;HostAndPort&gt; nodes = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">		nodes.add(<span class="keyword">new</span> HostAndPort(<span class="string">"192.168.12.168"</span>, <span class="number">7001</span>));</span><br><span class="line">		nodes.add(<span class="keyword">new</span> HostAndPort(<span class="string">"192.168.12.168"</span>, <span class="number">7002</span>));</span><br><span class="line">		nodes.add(<span class="keyword">new</span> HostAndPort(<span class="string">"192.168.12.168"</span>, <span class="number">7003</span>));</span><br><span class="line">		nodes.add(<span class="keyword">new</span> HostAndPort(<span class="string">"192.168.12.168"</span>, <span class="number">7004</span>));</span><br><span class="line">		nodes.add(<span class="keyword">new</span> HostAndPort(<span class="string">"192.168.12.168"</span>, <span class="number">7005</span>));</span><br><span class="line">		nodes.add(<span class="keyword">new</span> HostAndPort(<span class="string">"192.168.12.168"</span>, <span class="number">7006</span>));</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 创建jedis集群对象</span></span><br><span class="line">		JedisCluster jedisCluster = <span class="keyword">new</span> JedisCluster(nodes);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 设置值</span></span><br><span class="line">		jedisCluster.set(<span class="string">"jedisCluster_msg"</span>, <span class="string">"redis-集群"</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 获取键值</span></span><br><span class="line">		String msg = jedisCluster.get(<span class="string">"jedisCluster_msg"</span>);</span><br><span class="line">		System.out.println(msg);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 关闭jedisCluster连接(在程序执行完之后,才能关闭,他的内部已经封装了连接池)</span></span><br><span class="line">		jedisCluster.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Redis的通用命令"><a href="#Redis的通用命令" class="headerlink" title="Redis的通用命令"></a>Redis的通用命令</h2><p>在Resid安装目录下，使用redis-cli客户端连接Redis数据库</p>
<h3 id="连接远程Redis服务器"><a href="#连接远程Redis服务器" class="headerlink" title="连接远程Redis服务器"></a>连接远程Redis服务器</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">redis-cli -h [ip] -p [host] -a [密码]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果Redis设置了密码，则需要使用密码连接</span></span><br></pre></td></tr></table></figure>
<h4 id="密码设置"><a href="#密码设置" class="headerlink" title="密码设置"></a>密码设置</h4><ul>
<li>配置文件设置</li>
</ul>
<p>找到# requirepass foobared，去掉#注释，配置密码（或者干脆另起一行，照着写就是），需要重启Redis服务</p>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/21/6SiL8I3cA9hBJPf.png" alt=""></p>
<ul>
<li>命令设置</li>
</ul>
<p>密码信息保存在服务器内存中，不需要重启Redis服务，但服务器重启后将失效</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">config <span class="built_in">set</span> requirepass 密码 <span class="comment">#设置密码</span></span><br><span class="line">config get requirepass <span class="comment">#查看密码</span></span><br></pre></td></tr></table></figure>

<h3 id="keys-pattern"><a href="#keys-pattern" class="headerlink" title="keys pattern"></a>keys pattern</h3><p>获取所有与pattern匹配的key，返回所有与该key匹配的keys。<br>Patterm参数解析：<br><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/14/WOiUV69mgHh5DXF.png" alt=""></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) <span class="string">"company"</span></span><br><span class="line">2) <span class="string">"mylist"</span></span><br><span class="line">3) <span class="string">"myhash"</span></span><br><span class="line">4) <span class="string">"myset"</span></span><br></pre></td></tr></table></figure>

<h3 id="del-key1-key2…"><a href="#del-key1-key2…" class="headerlink" title="del key1 key2…"></a>del key1 key2…</h3><p>删除一个或多个指定的key，返回值是删除key的个数</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; del company</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure>

<h3 id="exists-key"><a href="#exists-key" class="headerlink" title="exists key"></a>exists key</h3><p>判断该key是否存在，1代表存在，0代表不存在</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; exists compnay</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; exists mylist</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>

<h3 id="type-key"><a href="#type-key" class="headerlink" title="type key"></a>type key</h3><p>获取指定key的类型。该命令将以字符串的格式返回。 返回的字符串为string、list、set、hash，如果key不存在返回none</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">type</span> company</span><br><span class="line">string</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">type</span> mylist</span><br><span class="line">list</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">type</span> myset</span><br><span class="line"><span class="built_in">set</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">type</span> myhash</span><br><span class="line"><span class="built_in">hash</span></span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>

<h3 id="select-切换数据库"><a href="#select-切换数据库" class="headerlink" title="select 切换数据库"></a>select 切换数据库</h3><p>一个Redis服务器可以包括多个数据库，客户端可以指定连接Redis中的哪个数据库，就好比一个mysql服务器中创建多个数据库，客户端连接时指定连接到哪个数据库。<font face="微软雅黑" color=red size=3>一个Redis实例最多可提供16个数据库，下标为0到15，客户端默认连接第0个数据库，</font>也可以通过select命令选择哪个数据库。</p>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/14/iIOsUeR2ZzGycSq.png" alt=""></p>
<h3 id="move移key到其他数据库"><a href="#move移key到其他数据库" class="headerlink" title="move移key到其他数据库"></a>move移key到其他数据库</h3><p>将key移到某个数据库；<br>move key 15 : 将当前数据库中的key移到15号数据库中<br><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/14/CEo16vHaZWelDBG.png" alt=""></p>
<h3 id="info-获取-redis-服务器的统计信息"><a href="#info-获取-redis-服务器的统计信息" class="headerlink" title="info 获取 redis 服务器的统计信息"></a>info 获取 redis 服务器的统计信息</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; info</span><br><span class="line"><span class="comment"># Server</span></span><br><span class="line">redis_version:3.2.100</span><br><span class="line">redis_git_sha1:00000000</span><br><span class="line">redis_git_dirty:0</span><br><span class="line">redis_build_id:1fe181ad2447fe38</span><br><span class="line">redis_mode:standalone</span><br><span class="line">os:Windows</span><br><span class="line">arch_bits:64</span><br><span class="line">multiplexing_api:winsock_IOCP</span><br><span class="line">gcc_version:0.0.0</span><br><span class="line">process_id:13028</span><br><span class="line">run_id:180f539248b89f5359be251550b4b28d0171805f</span><br><span class="line">tcp_port:6379</span><br><span class="line">uptime_in_seconds:1795</span><br><span class="line">uptime_in_days:0</span><br><span class="line">hz:10</span><br><span class="line">lru_clock:4401579</span><br><span class="line">config_file:</span><br><span class="line"></span><br><span class="line"><span class="comment"># Clients</span></span><br><span class="line">connected_clients:1</span><br><span class="line">client_longest_output_list:0</span><br><span class="line">client_biggest_input_buf:0</span><br><span class="line">blocked_clients:0</span><br><span class="line"></span><br><span class="line"><span class="comment"># Memory</span></span><br><span class="line">used_memory:4360680</span><br><span class="line">used_memory_human:4.16M</span><br><span class="line">used_memory_rss:4327104</span><br><span class="line">used_memory_peak:4360680</span><br><span class="line">used_memory_peak_human:4.16M</span><br><span class="line">used_memory_lua:33792</span><br><span class="line">mem_fragmentation_ratio:0.99</span><br><span class="line">mem_allocator:dlmalloc-2.8</span><br><span class="line"></span><br><span class="line"><span class="comment"># Persistence</span></span><br><span class="line">loading:0</span><br><span class="line">rdb_changes_since_last_save:0</span><br><span class="line">rdb_bgsave_in_progress:0</span><br><span class="line">rdb_last_save_time:1598235304</span><br><span class="line">rdb_last_bgsave_status:ok</span><br><span class="line">rdb_last_bgsave_time_sec:-1</span><br><span class="line">rdb_current_bgsave_time_sec:-1</span><br><span class="line">aof_enabled:0</span><br><span class="line">aof_rewrite_in_progress:0</span><br><span class="line">aof_rewrite_scheduled:0</span><br><span class="line">aof_last_rewrite_time_sec:-1</span><br><span class="line">aof_current_rewrite_time_sec:-1</span><br><span class="line">aof_last_bgrewrite_status:ok</span><br><span class="line">aof_last_write_status:ok</span><br><span class="line"></span><br><span class="line"><span class="comment"># Stats</span></span><br><span class="line">total_connections_received:4</span><br><span class="line">total_commands_processed:5</span><br><span class="line">instantaneous_ops_per_sec:0</span><br><span class="line">rejected_connections:0</span><br><span class="line">sync_full:0</span><br><span class="line">sync_partial_ok:0</span><br><span class="line">sync_partial_err:0</span><br><span class="line">expired_keys:0</span><br><span class="line">evicted_keys:0</span><br><span class="line">keyspace_hits:0</span><br><span class="line">keyspace_misses:0</span><br><span class="line">pubsub_channels:0</span><br><span class="line">pubsub_patterns:0</span><br><span class="line">latest_fork_usec:0</span><br><span class="line"></span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_repl_offset:0</span><br><span class="line">repl_backlog_active:0</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:0</span><br><span class="line">repl_backlog_histlen:0</span><br><span class="line"></span><br><span class="line"><span class="comment"># CPU</span></span><br><span class="line">used_cpu_sys:0.05</span><br><span class="line">used_cpu_user:0.03</span><br><span class="line">used_cpu_sys_children:0.00</span><br><span class="line">used_cpu_user_children:0.00</span><br><span class="line"></span><br><span class="line"><span class="comment"># Keyspace</span></span><br><span class="line">db0:keys=1,expires=1,avg_ttl=425280</span><br></pre></td></tr></table></figure>


<h3 id="Help"><a href="#Help" class="headerlink" title="Help"></a>Help</h3><p>HELP命令可以查看redis的一些命令的用法；当忘记某个命令的使用时很有用。<br><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/14/OZ4El3MFpV1eRKk.png" alt=""></p>
<h2 id="Redis的数据类型"><a href="#Redis的数据类型" class="headerlink" title="Redis的数据类型"></a>Redis的数据类型</h2><h3 id="Redis的5种数据类型"><a href="#Redis的5种数据类型" class="headerlink" title="Redis的5种数据类型"></a>Redis的5种数据类型</h3><p>redis是一种高级的key-value的存储系统，其中value支持五种数据类型：</p>
<blockquote>
<ol>
<li>字符串（String）</li>
<li>哈希（hash）</li>
<li>字符串列表（list）</li>
<li>字符串集合（set）</li>
<li>有序字符串集合（sorted set）</li>
</ol>
</blockquote>
<p>在日常开发中主要使用比较多的有字符串、哈希、字符串列表、字符串集合四种类型，其中最为常用的是字符串类型。</p>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/14/G4eqAvjyRBLa8Wx.png" alt=""></p>
<p>关于key的定义，注意如下几点：</p>
<blockquote>
<ol>
<li>key不要太长，最好不要超过1024个字节，这不仅会消耗内存还会降低查找效率</li>
<li>key不要太短，如果太短会降低key的可读性 </li>
<li>在项目中，key最好有一个统一的命名规范（见名知意）</li>
</ol>
</blockquote>
<h3 id="字符串类型string"><a href="#字符串类型string" class="headerlink" title="字符串类型string"></a>字符串类型string</h3><h4 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h4><p>字符串类型是Redis中最为基础的数据存储类型，它在Redis中是二进制安全的，这便意味着字符串类型存入和获取的数据相同。在Redis中字符串类型的Value最多可以容纳的数据长度是512M。</p>
<h4 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h4><ul>
<li>set key value</li>
</ul>
<p><font face="微软雅黑" color=red size=3>设定key的value。指定字符串的value，如果该key存在则进行覆盖操作。总是返回”OK”</font></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> company <span class="string">"itcast"</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>get key</li>
</ul>
<p><font face="微软雅黑" color=red size=3>获取key的value。如果与该key关联的value不是String类型，redis将返回错误信息，因为get命令只能用于获取String value；如果该key不存在，返回(nil)。</font></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> name <span class="string">"itcast"</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line"><span class="string">"itcast"</span></span><br></pre></td></tr></table></figure>

<ul>
<li>del key</li>
</ul>
<p>删除指定key，返回影响的记录数</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; del name</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure>

<h3 id="哈希类型hash"><a href="#哈希类型hash" class="headerlink" title="哈希类型hash"></a>哈希类型hash</h3><h4 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h4><p>Redis中的Hash类型可以看成具有String Key和String Value的map容器。所以Hash类型非常适合于存储键值对的信息。如Username、Password和Age等。如果Hash中包含很少的字段，那么该类型的数据也将仅占用很少的内存空间。<font face="微软雅黑" color=red size=3>每一个Hash可以存储4294967295个键值对。</font></p>
<h4 id="常用命令-1"><a href="#常用命令-1" class="headerlink" title="常用命令"></a>常用命令</h4><ul>
<li>hset key field value</li>
</ul>
<p>为指定的key设定field/value对（键值对）。返回影响的记录数</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hset myhash username haohao</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>hget key field</li>
</ul>
<p>获取指定的key中的field的值</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hset myhash username haohao</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; hget myhash username</span><br><span class="line"><span class="string">"haohao"</span></span><br></pre></td></tr></table></figure>

<ul>
<li>hmset key field value [field1 value1 field2 value2…]</li>
</ul>
<p>设置key中的多个filed/value</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hmset myhash username jack age 21</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>

<ul>
<li>hmget key fileds</li>
</ul>
<p>获取key中的多个filed的值</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hmget myhash username age </span><br><span class="line">1)”jack”</span><br><span class="line">2)”18”</span><br></pre></td></tr></table></figure>

<ul>
<li>hgetall key</li>
</ul>
<p>获取key中所有map的key和value</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hset h_user id 1</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; hmset h_user age 12 name itcast gender 1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; hgetall h_user</span><br><span class="line">1) <span class="string">"id"</span></span><br><span class="line">2) <span class="string">"1"</span></span><br><span class="line">3) <span class="string">"age"</span></span><br><span class="line">4) <span class="string">"12"</span></span><br><span class="line">5) <span class="string">"name"</span></span><br><span class="line">6) <span class="string">"itcast"</span></span><br><span class="line">7) <span class="string">"gender"</span></span><br><span class="line">8) <span class="string">"1"</span></span><br></pre></td></tr></table></figure>

<ul>
<li>hdel key field [field … ]</li>
</ul>
<p>可以删除一个或多个字段，返回值是被删除的字段个数</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hdel myhash username age</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; hget myhash username</span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>HEXISTS key field</li>
</ul>
<p>查看哈希表 key 中，判断域field 是否存在</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hexists myhash name</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; hexists myhash birthday</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br></pre></td></tr></table></figure>

<ul>
<li>HKEYS key和HVALS key</li>
</ul>
<p>HKEYS key：获取哈希表Key的所有域field<br>HVALS key：获取哈希表key的所有域field对应的值</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hkeys h_user</span><br><span class="line">1) <span class="string">"id"</span></span><br><span class="line">2) <span class="string">"name"</span></span><br><span class="line">127.0.0.1:6379&gt; hvals h_user</span><br><span class="line">1) <span class="string">"1"</span></span><br><span class="line">2) <span class="string">"itcast"</span></span><br></pre></td></tr></table></figure>

<ul>
<li>HLEN key</li>
</ul>
<p>返回哈希表 key 中域field的数量</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hlen h_user</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br></pre></td></tr></table></figure>


<h3 id="列表类型list"><a href="#列表类型list" class="headerlink" title="列表类型list"></a>列表类型list</h3><h4 id="概述-2"><a href="#概述-2" class="headerlink" title="概述"></a>概述</h4><p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/14/qEirlLuhsSjv1cQ.png" alt=""></p>
<p>在Redis中，List类型是按照插入顺序排序的字符串链表（java中的linkedlist）。和数据结构中的普通链表一样，我们可以在其头部(left)和尾部(right)添加新的元素。在插入时，如果该键并不存在，Redis将为该键创建一个新的链表。与此相反，如果链表中所有的元素均被移除，那么该键也将会被从数据库中删除。<font face="微软雅黑" color=red size=3>List中可以包含的最大元素数量是4294967295，list类型允许有重复元素</font></p>
<h4 id="常用命令-2"><a href="#常用命令-2" class="headerlink" title="常用命令"></a>常用命令</h4><ul>
<li>lpush key value1 value2 …</li>
</ul>
<p>在指定的key所关联的list的<font face="微软雅黑" color=red size=3>头部插入</font>所有的values，如果该key不存在，该命令在插入的之前创建一个与该key关联的空链表，之后再向该链表的头部插入数据。插入成功，返回元素的个数。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lpush mylist a b c</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>rpush key value1 value2 …</li>
</ul>
<p>在指定的key对应的list的<font face="微软雅黑" color=red size=3>尾部插入</font>所有的value，如果该key不存在，该命令在插入之前创建一个与该key对应的空链表，再从尾部插入数据。插入成功，返回元素的个数。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lpush l_users 1 2 3 a b</span><br><span class="line">(<span class="built_in">integer</span>) 5</span><br></pre></td></tr></table></figure>
<p><font face="微软雅黑" color=red size=3>注意：是左边添加，所以最终最左边的元素为b</font></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; rpush l_users d e</span><br><span class="line">(<span class="built_in">integer</span>) 7</span><br></pre></td></tr></table></figure>
<p><font face="微软雅黑" color=red size=3>注意：是右边添加，所以最终最右边的元素为e</font></p>
<ul>
<li>lrange key start end查看列表</li>
</ul>
<p>获取链表中从start到end的元素的值，<font face="微软雅黑" color=red size=3>索引从0开始，如果为负数，-1表示倒数第一个元素，-2表示倒数第二个元素，以此类推。</font></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lrange l_users 0 -1</span><br><span class="line">1) <span class="string">"b"</span></span><br><span class="line">2) <span class="string">"a"</span></span><br><span class="line">3) <span class="string">"3"</span></span><br><span class="line">4) <span class="string">"2"</span></span><br><span class="line">5) <span class="string">"1"</span></span><br><span class="line">6) <span class="string">"d"</span></span><br><span class="line">7) <span class="string">"e"</span></span><br></pre></td></tr></table></figure>

<ul>
<li>lpop key，从头部弹出元素(移除)</li>
</ul>
<p>返回并弹出指定的key关联的链表中的第一个元素，即头部元素。如果该key不存在，返回nil；若key存在，则返回链表的头部元素。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lpush mylist a b c</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; lpop mylist</span><br><span class="line"><span class="string">"c"</span></span><br><span class="line">127.0.0.1:6379&gt; lpop mylist</span><br><span class="line"><span class="string">"b"</span></span><br></pre></td></tr></table></figure>

<ul>
<li>rpop key，从尾部弹出元素(移除)</li>
</ul>
<p>返回并弹出指定的key关联的链表中的最后一个元素，即尾部元素。如果该key不存在，返回nil；若key存在，则返回链表的尾部元素。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lpush mylist a b c</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; rpop mylist</span><br><span class="line"><span class="string">"a"</span></span><br></pre></td></tr></table></figure>

<ul>
<li>LLEN key</li>
</ul>
<p>返回指定key对应链表中元素的个数</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lrange l_users 0 -1</span><br><span class="line">1) <span class="string">"b"</span></span><br><span class="line">2) <span class="string">"a"</span></span><br><span class="line">3) <span class="string">"3"</span></span><br><span class="line">4) <span class="string">"2"</span></span><br><span class="line">5) <span class="string">"1"</span></span><br><span class="line">6) <span class="string">"d"</span></span><br><span class="line">7) <span class="string">"e"</span></span><br><span class="line">127.0.0.1:6379&gt; llen l_users</span><br><span class="line">(<span class="built_in">integer</span>) 7</span><br></pre></td></tr></table></figure>

<ul>
<li>LREM key count value</li>
</ul>
<p>LREM命令会删除列表中前count个值为value的元素，返回实际删除的元素个数。根据count值的不同，该命令的执行方式会有所不同：</p>
<blockquote>
<ol>
<li>当count&gt;0时， LREM会从列表左边(头部)开始删除。</li>
<li>当count&lt;0时， LREM会从列表后边(尾部)开始删除。</li>
<li>当count=0时， LREM删除所有值为value的元素。</li>
</ol>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lpush l_users 1 2 3</span><br><span class="line">(<span class="built_in">integer</span>) 10</span><br><span class="line">127.0.0.1:6379&gt; lrange l_users 0 -1</span><br><span class="line"> 1) <span class="string">"3"</span></span><br><span class="line"> 2) <span class="string">"2"</span></span><br><span class="line"> 3) <span class="string">"1"</span></span><br><span class="line"> 4) <span class="string">"b"</span></span><br><span class="line"> 5) <span class="string">"a"</span></span><br><span class="line"> 6) <span class="string">"3"</span></span><br><span class="line"> 7) <span class="string">"2"</span></span><br><span class="line"> 8) <span class="string">"1"</span></span><br><span class="line"> 9) <span class="string">"d"</span></span><br><span class="line">10) <span class="string">"e"</span></span><br></pre></td></tr></table></figure>

<p>删除列表l_users中2个值为3的元素</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lrem l_users 2 3</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; lrange l_users 0 -1</span><br><span class="line">1) <span class="string">"2"</span></span><br><span class="line">2) <span class="string">"1"</span></span><br><span class="line">3) <span class="string">"b"</span></span><br><span class="line">4) <span class="string">"a"</span></span><br><span class="line">5) <span class="string">"2"</span></span><br><span class="line">6) <span class="string">"1"</span></span><br><span class="line">7) <span class="string">"d"</span></span><br><span class="line">8) <span class="string">"e"</span></span><br></pre></td></tr></table></figure>

<ul>
<li>LINDEX key index</li>
</ul>
<p>获得指定索引的元素值</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lindex l_users 3</span><br><span class="line"><span class="string">"b"</span></span><br></pre></td></tr></table></figure>

<h3 id="无序集合set"><a href="#无序集合set" class="headerlink" title="无序集合set"></a>无序集合set</h3><h4 id="概述-3"><a href="#概述-3" class="headerlink" title="概述"></a>概述</h4><p>在Redis中，我们可以将Set类型看作为没有排序的字符集合，和List类型一样，我们也可以在该类型的数据值上执行添加、删除或判断某一元素是否存在等操作。<font face="微软雅黑" color=red size=3>set集合类型可包含的最大元素数量是4294967295，</font>和List类型不同的是，set集合类型<font face="微软雅黑" color=red size=3>中不允许出现重复的元素，且无序。</font>　</p>
<h4 id="常用命令-3"><a href="#常用命令-3" class="headerlink" title="常用命令"></a>常用命令</h4><ul>
<li>sadd key values[value1 value2 …]</li>
</ul>
<p>向set中无序添加一个或多个数据，如果该key的值已有则不会重复添加</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; sadd myset a b c</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br></pre></td></tr></table></figure>

<ul>
<li>smembers key</li>
</ul>
<p>获取set中所有的成员</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; smembers myset</span><br><span class="line">1) <span class="string">"c"</span></span><br><span class="line">2) <span class="string">"a"</span></span><br><span class="line">3) <span class="string">"b"</span></span><br></pre></td></tr></table></figure>

<ul>
<li>srem key members[member1、member2…]</li>
</ul>
<p>删除set中指定的成员</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; srem myset a b</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; smembers myset</span><br><span class="line">1) <span class="string">"c"</span></span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>SISMEMBER key member</li>
</ul>
<p>判断元素是否存在集合中</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; sismember myset c</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure>

<ul>
<li>SCARD key</li>
</ul>
<p>获得集合中元素的个数</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; scard myset</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure>

<h3 id="有序集合sorted-set"><a href="#有序集合sorted-set" class="headerlink" title="有序集合sorted set"></a>有序集合sorted set</h3><h4 id="概述-4"><a href="#概述-4" class="headerlink" title="概述"></a>概述</h4><p>在集合类型的基础上有序集合类型（sorted set）为集合中的每个元素都关联一个分数，这使得我们不仅可以完成插入、删除和判断元素是否存在在集合中，还能够获得分数最高或最低的前N个元素、获取指定分数范围内的元素等与分数有关的操作。</p>
<h4 id="有序集合和列表类型区别："><a href="#有序集合和列表类型区别：" class="headerlink" title="有序集合和列表类型区别："></a>有序集合和列表类型区别：</h4><ol>
<li><p>相同点：</p>
<blockquote>
<p>1、二者都是有序的。<br>2、二者都可以获得某一范围的元素。</p>
</blockquote>
</li>
<li><p>不同点：</p>
<blockquote>
<p>1、列表类型是通过链表实现的，获取靠近两端的数据速度极快，而当元素增多后，访问中间数据的速度会变慢。<br>2、有序集合类型使用散列表实现，所以即使读取位于中间部分的数据也很快。<br>3、列表中不能简单的调整某个元素的位置，但是有序集合可以（通过更改分数实现）<br>4、有序集合要比列表类型更耗内存。</p>
</blockquote>
</li>
</ol>
<h4 id="常用命令-4"><a href="#常用命令-4" class="headerlink" title="常用命令"></a>常用命令</h4><ul>
<li>增加元素：ZADD key score member [score member …]</li>
</ul>
<p>向有序集合中加入一个元素和该元素的分数，<font face="微软雅黑" color=red size=3>如果该元素已经存在则会用新的分数替换原有的分数。返回值是新加入到集合中的元素个数，不包含之前已经存在的元素。</font>　</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zadd z_users 10 a 20 b 30 c</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br></pre></td></tr></table></figure>

<ul>
<li>获取指定区间元素：ZRANGE key start stop [WITHSCORES]</li>
</ul>
<p>返回有序集合key 中，指定区间内的成员。其中成员的位置按 score 值递增 (从小到大) 来排序。start开始位置，stop结束位置（-1则为最后一个元素）</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zrange z_users 0 -1</span><br><span class="line">1) <span class="string">"a"</span></span><br><span class="line">2) <span class="string">"b"</span></span><br><span class="line">3) <span class="string">"c"</span></span><br><span class="line">127.0.0.1:6379&gt; zrange z_users 0 -1 withscores</span><br><span class="line">1) <span class="string">"a"</span></span><br><span class="line">2) <span class="string">"10"</span></span><br><span class="line">3) <span class="string">"b"</span></span><br><span class="line">4) <span class="string">"20"</span></span><br><span class="line">5) <span class="string">"c"</span></span><br><span class="line">6) <span class="string">"30"</span></span><br></pre></td></tr></table></figure>

<ul>
<li>按照排名范围删除元素：ZREMRANGEBYRANK key start stop</li>
</ul>
<p>删除排名（按分数排）范围在第3的元素</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zremrangebyrank z_users 2 2</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; zrange z_users 0 -1</span><br><span class="line">1) <span class="string">"a"</span></span><br><span class="line">2) <span class="string">"b"</span></span><br></pre></td></tr></table></figure>

<ul>
<li>按照分数范围删除元素：ZREMRANGEBYSCORE key min max</li>
</ul>
<p>删除分数范围为5-10（包括端点值5和10）的元素</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zremrangebyscore z_users 5 10</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; zrange z_users 0 -1</span><br><span class="line">1) <span class="string">"b"</span></span><br></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/14/3IR7NLMixqGwPeA.png" alt=""></p>
<h2 id="Redis的持久化"><a href="#Redis的持久化" class="headerlink" title="Redis的持久化"></a>Redis的持久化</h2><h3 id="持久化概述"><a href="#持久化概述" class="headerlink" title="持久化概述"></a>持久化概述</h3><p>Redis的高性能是由于其将所有数据都存储在了内存中，为了使Redis在重启之后仍能保证数据不丢失，需要将数据从内存中同步到硬盘中，这一过程就是持久化。<br><font face="微软雅黑" color=red size=3>Redis支持两种方式的持久化，一种是RDB方式，一种是AOF方式。可以单独使用其中一种或将二者结合使用。</font></p>
<blockquote>
<ul>
<li>RDB持久化（默认支持，无需配置）<br>该机制是在指定的时间间隔内将内存中的数据集快照写入磁盘。</li>
</ul>
</blockquote>
<ul>
<li>AOF持久化<br>该机制将以日志的形式记录服务器所处理的每一个写操作，在Redis服务器启动之初会读取该文件来重新构建数据库，以保证启动后数据库中的数据是完整的。</li>
<li>无持久化<br>可以通过配置的方式禁用Redis服务器的持久化功能，这样可以将Redis视为一个功能加强版的memcached了。</li>
<li>redis可以同时使用RDB和AOF</li>
</ul>
<h3 id="RDB持久化机制"><a href="#RDB持久化机制" class="headerlink" title="RDB持久化机制"></a>RDB持久化机制</h3><h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><blockquote>
<ol>
<li>一旦采用该方式，那么你的整个Redis数据库将只包含一个文件（rdb文件），这对于文件备份而言是非常完美的。比如，你可能打算每个小时归档一次最近24小时的数据，同时还要每天归档一次最近30天的数据。通过这样的备份策略，一旦系统出现灾难性故障，我们可以非常容易的进行恢复。</li>
<li>对于灾难恢复而言，RDB是非常不错的选择。因为我们可以非常轻松的将一个单独的文件压缩后再转移到其它存储介质上</li>
<li>性能最大化。对于Redis的服务进程而言，在开始持久化时，它唯一需要做的只是fork（分叉）出子进程，之后再由子进程完成这些持久化的工作，这样就可以极大的避免服务进程执行IO操作了。<font face="微软雅黑" color=red size=3>相比于AOF机制，如果数据集很大，RDB的启动效率会更高</font>　</li>
</ol>
</blockquote>
<h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><blockquote>
<ol>
<li>如果你想保证数据的高可用性（就是内存数据不丢失），即最大限度的避免数据丢失，那么RDB将不是一个很好的选择。因为系统一旦在定时持久化之前出现宕机现象，此前没有来得及写入磁盘的数据都将丢失。</li>
<li>由于RDB是通过fork子进程来协助完成数据持久化工作的，因此，如果当数据集较大时，可能会导致整个服务器停止服务几百毫秒，甚至是1秒钟</li>
</ol>
</blockquote>
<h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p>在redis.windows.conf配置文件中有如下配置：</p>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/17/WQp4DUeunvTHNwX.png" alt=""></p>
<p>其中，上面配置的是RDB方式数据持久化时机，可以多个条件配合<br><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/17/Npj1Gsm84fP3zew.png" alt=""></p>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/17/LVhyrgU6G8JTdXM.png" alt=""></p>
<h3 id="AOF持久化机制"><a href="#AOF持久化机制" class="headerlink" title="AOF持久化机制"></a>AOF持久化机制</h3><h4 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h4><blockquote>
<ol>
<li>该机制可以带来更高的数据安全性，即数据持久性。Redis中提供了3种同步策略，即每秒同步、每修改同步和不同步。事实上，每秒同步也是异步完成的，其效率也是非常高的，所差的是一旦系统出现宕机现象，那么这一秒钟之内修改的数据将会丢失。而每修改同步，我们可以将其视为同步持久化，即每次发生的数据变化都会被立即记录到磁盘中。可以预见，这种方式在效率上是最低的。至于无同步，无需多言，我想大家都能正确的理解它。</li>
<li>由于该机制对日志文件的写入操作采用的是append模式，因此在写入过程中即使出现宕机现象，也不会破坏日志文件中已经存在的内容。然而如果本次操作只是写入了一半数据就出现了系统崩溃问题，不用担心，在Redis下一次启动之前，我们可以通过redis-check-aof工具来帮助我们解决数据一致性的问题。</li>
<li>如果日志过大，Redis可以自动启用rewrite机制。即Redis以append模式不断的将修改数据写入到老的磁盘文件中，同时Redis还会创建一个新的文件用于记录此期间有哪些修改命令被执行。因此在进行rewrite切换时可以更好的保证数据安全性。</li>
<li>AOF包含一个格式清晰、易于理解的日志文件用于记录所有的修改操作。事实上，我们也可以通过该文件完成数据的重建</li>
</ol>
</blockquote>
<h4 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h4><blockquote>
<ol>
<li>对于相同数量的数据集而言，AOF文件通常要大于RDB文件</li>
<li>根据同步策略的不同，AOF在运行效率上往往会慢于RDB。</li>
</ol>
</blockquote>
<h4 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h4><h5 id="开启AOF持久化"><a href="#开启AOF持久化" class="headerlink" title="开启AOF持久化"></a>开启AOF持久化</h5><p>在redis.windows.conf配置文件中有如下配置：</p>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/17/wBD2WvHrakPzyO5.png" alt=""></p>
<p>将appendonly修改为yes，开启aof持久化机制，默认会在目录下产生一个appendonly.aof文件<br>启动需要指定配置文件</p>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/17/IUujFNZEvCBxcVD.png" alt=""></p>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/17/w9dbJgyOiMtUG4R.png" alt=""></p>
<h5 id="AOF持久化时机"><a href="#AOF持久化时机" class="headerlink" title="AOF持久化时机"></a>AOF持久化时机</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#appendfsync always</span></span><br><span class="line">appendfsync everysec</span><br><span class="line"><span class="comment">#appendfsync no</span></span><br></pre></td></tr></table></figure>

<p>上述配置为aof持久化的时机，解释如下：<br><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/17/ABU1SDX6qIe93HV.png" alt=""></p>
<h2 id="Jedis的基本使用"><a href="#Jedis的基本使用" class="headerlink" title="Jedis的基本使用"></a>Jedis的基本使用</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>Redis不仅是使用命令来操作，现在基本上主流的语言都有客户端支持，比如java、C、C#、C++、php、Node.js、Go等。 在官方网站里列一些Java的客户端，有Jedis、Redisson、Jredis、JDBC-Redis、等其中官方推荐使用Jedis和Redisson。 在企业中用的最多的就是Jedis，Jedis同样也是托管在github上，地址：</p>
<blockquote>
<p><a href="https://github.com/xetorthio/jedis" target="_blank" rel="noopener">https://github.com/xetorthio/jedis</a></p>
</blockquote>
<p>Jedis基本上实现了所有的Redis命令，并且还支持连接池、集群等高级的用法，而且使用简单，使得在Java中使用Redis服务将变得非常的简单，Maven依赖：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h3><h4 id="常用API"><a href="#常用API" class="headerlink" title="常用API"></a>常用API</h4><p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/17/lxBiO4D3s5nV2KL.png" alt=""></p>
<h4 id="代码操作"><a href="#代码操作" class="headerlink" title="代码操作"></a>代码操作</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * jedis的使用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisTest1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        目的：使用jedis操作redis，进行存取数据</span></span><br><span class="line"><span class="comment">        1.创建jedis对象，连接到redis服务器端</span></span><br><span class="line"><span class="comment">          public Jedis(String host, int port)</span></span><br><span class="line"><span class="comment">           host，指定redis服务器地址</span></span><br><span class="line"><span class="comment">           port,指定redis使用的端口号</span></span><br><span class="line"><span class="comment">        */</span>      </span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">"localhost"</span>,<span class="number">6379</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        2.往redis里面写入数据</span></span><br><span class="line"><span class="comment">        通过jedis操作redis，与使用redis客户端执行命令是一致的</span></span><br><span class="line"><span class="comment">        客户端所有的命令都是jedis的方法，所有key和value都是方法的参数</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="comment">//存入字符串数据,jedis.set(key,value);</span></span><br><span class="line">        jedis.set(<span class="string">"name"</span>,<span class="string">"javaee87"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//存入list数据，jedis.lpush(key,value可变参数);</span></span><br><span class="line">        jedis.lpush(<span class="string">"myList2"</span>,<span class="string">"one"</span>,<span class="string">"two"</span>,<span class="string">"three"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//3.从redis里面读取数据</span></span><br><span class="line">        <span class="comment">//取string数据，jedis.get(key)</span></span><br><span class="line">        String name = jedis.get(<span class="string">"name"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//取list数据,List&lt;String&gt; myList2 = jedis.lrange(key,start,end);</span></span><br><span class="line">        List&lt;String&gt; myList2 =  jedis.lrange(<span class="string">"myList2"</span>,<span class="number">0</span>,-<span class="number">1</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//打印</span></span><br><span class="line">        System.out.println(<span class="string">"name="</span>+name);</span><br><span class="line">        System.out.println(<span class="string">"myList2="</span>+myList2);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.关闭连接</span></span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="连接池的使用"><a href="#连接池的使用" class="headerlink" title="连接池的使用"></a>连接池的使用</h3><h4 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h4><p>jedis连接资源的创建与销毁是很消耗程序性能，所以jedis为我们提供了jedis的池化技术，jedisPool在创建时初始化一些连接资源存储到连接池中，使用jedis连接资源时不需要创建，而是从连接池中获取一个资源进行redis的操作，使用完毕后，不需要销毁该jedis连接资源，而是将该资源归还给连接池，供其他请求使用。</p>
<h4 id="常用API-1"><a href="#常用API-1" class="headerlink" title="常用API"></a>常用API</h4><p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/17/noXtdr7NS8ICg4p.png" alt=""></p>
<h4 id="代码操作-1"><a href="#代码操作-1" class="headerlink" title="代码操作"></a>代码操作</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPool;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPoolConfig;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * jedis的使用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisTest2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//目的：使用连接池优化jedis操作redis，进行存取数据</span></span><br><span class="line">        <span class="comment">//1.创建jedis连接池配置对象，并设置配置连接池的参数</span></span><br><span class="line">        JedisPoolConfig config = <span class="keyword">new</span> JedisPoolConfig();</span><br><span class="line">        config.setMaxTotal(<span class="number">100</span>);<span class="comment">//最大连接数</span></span><br><span class="line">        config.setMaxWaitMillis(<span class="number">3000</span>);<span class="comment">//用户等待连接超时事件，等待3秒</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//2.根据配置对象创建jedis连接池对象</span></span><br><span class="line">        <span class="comment">//public JedisPool(GenericObjectPoolConfig poolConfig, String host, int port)</span></span><br><span class="line">        JedisPool jedisPool = <span class="keyword">new</span> JedisPool(config,<span class="string">"localhost"</span>,<span class="number">6379</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//3.根据连接池获取jedis连接对象</span></span><br><span class="line">        Jedis jedis = jedisPool.getResource();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//4.往redis里面写入数据</span></span><br><span class="line">        jedis.set(<span class="string">"name"</span>,<span class="string">"javaee87"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//存入list数据，jedis.lpush(key,value可变参数);</span></span><br><span class="line">        jedis.lpush(<span class="string">"myList2"</span>,<span class="string">"one"</span>,<span class="string">"two"</span>,<span class="string">"three"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//5.从redis里面读取数据</span></span><br><span class="line">        <span class="comment">//取string数据，jedis.get(key)</span></span><br><span class="line">        String name = jedis.get(<span class="string">"name"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//取list数据,List&lt;String&gt; myList2 = jedis.lrange(key,start,end);</span></span><br><span class="line">        List&lt;String&gt; myList2 =  jedis.lrange(<span class="string">"myList2"</span>,<span class="number">0</span>,-<span class="number">1</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//打印</span></span><br><span class="line">        System.out.println(<span class="string">"name="</span>+name);</span><br><span class="line">        System.out.println(<span class="string">"myList2="</span>+myList2);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//6.关闭连接</span></span><br><span class="line">        jedis.close();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//7.关闭连接池</span></span><br><span class="line">        <span class="comment">//jedisPool.close();,连接池不要关闭，关闭了连接池就不能用了</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="连接池工具类"><a href="#连接池工具类" class="headerlink" title="连接池工具类"></a>连接池工具类</h3><h4 id="配置文件-1"><a href="#配置文件-1" class="headerlink" title="配置文件"></a>配置文件</h4><p>jedis.properties</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">maxTotal=100</span><br><span class="line">maxWaitMillis=3000</span><br><span class="line">host=localhost</span><br><span class="line">port=6379</span><br></pre></td></tr></table></figure>

<h4 id="工具类"><a href="#工具类" class="headerlink" title="工具类"></a>工具类</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPool;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPoolConfig;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ResourceBundle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//jedis连接池对象</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> JedisPool jedisPool;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//通过静态代码块初始化</span></span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        <span class="comment">//解析jedis.properties配置文件</span></span><br><span class="line">        <span class="comment">//ResourceBundle专门用于解析properties文件，只需要提供文件名就可以解析</span></span><br><span class="line">        ResourceBundle resourceBundle = ResourceBundle.getBundle(<span class="string">"jedis"</span>);</span><br><span class="line">        <span class="comment">//获取里面的数据</span></span><br><span class="line">        <span class="keyword">int</span> maxTotal = Integer.parseInt(resourceBundle.getString(<span class="string">"maxTotal"</span>));</span><br><span class="line">        <span class="keyword">int</span> maxWaitMillis = Integer.parseInt(resourceBundle.getString(<span class="string">"maxWaitMillis"</span>));</span><br><span class="line">        String host = resourceBundle.getString(<span class="string">"host"</span>);</span><br><span class="line">        <span class="keyword">int</span> port = Integer.parseInt(resourceBundle.getString(<span class="string">"port"</span>));</span><br><span class="line">        <span class="comment">//创建连接池配置对象</span></span><br><span class="line">        JedisPoolConfig config = <span class="keyword">new</span> JedisPoolConfig();</span><br><span class="line">        config.setMaxTotal(maxTotal);</span><br><span class="line">        config.setMaxWaitMillis(maxWaitMillis);</span><br><span class="line">        <span class="comment">//初始化连接池对象</span></span><br><span class="line">        jedisPool = <span class="keyword">new</span> JedisPool(config,host,port);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//提供一个方便获取jedis连接的工具类方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Jedis <span class="title">getJedis</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> jedisPool.getResource();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.util.JedisUtils;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPool;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPoolConfig;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * jedis的使用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisTest3</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//目的：使用连接池优化jedis操作redis，进行存取数据</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.使用工具类获取jedis连接对象</span></span><br><span class="line">        Jedis jedis = JedisUtils.getJedis();</span><br><span class="line">        <span class="comment">//2.往redis里面写入数据</span></span><br><span class="line">        jedis.set(<span class="string">"name"</span>,<span class="string">"javaee87黑马程序员"</span>);</span><br><span class="line">        <span class="comment">//存入list数据，jedis.lpush(key,value可变参数);</span></span><br><span class="line">        jedis.lpush(<span class="string">"myList2"</span>,<span class="string">"one"</span>,<span class="string">"two"</span>,<span class="string">"three"</span>);</span><br><span class="line">        <span class="comment">//3.从redis里面读取数据</span></span><br><span class="line">        <span class="comment">//取string数据，jedis.get(key)</span></span><br><span class="line">        String name = jedis.get(<span class="string">"name"</span>);</span><br><span class="line">        <span class="comment">//取list数据,List&lt;String&gt; myList2 = jedis.lrange(key,start,end);</span></span><br><span class="line">        List&lt;String&gt; myList2 =  jedis.lrange(<span class="string">"myList2"</span>,<span class="number">0</span>,-<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//打印</span></span><br><span class="line">        System.out.println(<span class="string">"name="</span>+name);</span><br><span class="line">        System.out.println(<span class="string">"myList2="</span>+myList2);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.关闭连接</span></span><br><span class="line">        jedis.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="过期与淘汰策略"><a href="#过期与淘汰策略" class="headerlink" title="过期与淘汰策略"></a>过期与淘汰策略</h2><p>长期将Redis作为缓存使用，难免会遇到内存空间存储瓶颈，当Redis内存超出物理内存限制时，Redis性能将急剧下降。此时如何淘汰无用数据释放空间，存储新数据就变得尤为重要了。</p>
<h3 id="设置占用内存"><a href="#设置占用内存" class="headerlink" title="设置占用内存"></a>设置占用内存</h3><ul>
<li>配置文件配置<br>找到# maxmemory <bytes>，去掉#注释，设置maxmemory参数，maxmemory是bytes字节类型，注意转换，一般推荐Redis设置使用内存为最大物理内存的四分之三，Redis服务重启后不会失效</li>
</ul>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/24/oa6WdOB9ZN7GeM5.png" alt=""></p>
<p>不会转换的，可到如下网址换算大小:</p>
<blockquote>
<p>在线文件大小换算：<a href="https://www.bejson.com/convert/filesize/" target="_blank" rel="noopener">https://www.bejson.com/convert/filesize/</a></p>
</blockquote>
<ul>
<li>命令修改<br>使用redis-cli客户端命令修改，Redis服务重启后将失效</li>
</ul>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/24/4on5pqOXCvKVrDw.png" alt=""></p>
<blockquote>
<p>如果不设置最大内存大小或者设置最大内存大小为0，在64位操作系统下不限制内存大小，在32位操作系统下最多使用3GB内存</p>
</blockquote>
<h3 id="过期策略"><a href="#过期策略" class="headerlink" title="过期策略"></a>过期策略</h3><p>Redis采用的过期策略是：定期删除+惰性删除策略。</p>
<ul>
<li>为什么不用定时删除策略?</li>
</ul>
<p>定时删除，用一个定时器来负责监视key，过期则自动删除。虽然内存及时释放，但是十分消耗CPU资源。在大并发请求下，CPU要将时间应用在处理请求，而不是删除key。因此没有采用这一策略.</p>
<ul>
<li>定期删除+惰性删除是如何工作的呢?</li>
</ul>
<p>定期删除，redis默认每个100ms检查一次，随机抽取进行检查(如果每隔100ms，全部key进行检查，redis岂不是卡死)。因此，如果只采用定期删除策略，会导致很多key到时间没有删除。于是，惰性删除派上用场。也就是说在你获取某个key的时候，redis会检查一下，这个key如果设置了过期时间那么是否过期了？如果过期了此时就会删除。</p>
<ul>
<li>采用定期删除+惰性删除就没其他问题了么?</li>
</ul>
<p>不是的，如果定期删除没删除key。然后你也没即时去请求key，也就是说惰性删除也没生效。这样，redis的内存会越来越高。那么就应该采用内存淘汰机制。</p>
<h3 id="淘汰策略"><a href="#淘汰策略" class="headerlink" title="淘汰策略"></a>淘汰策略</h3><p>Redis定义了六种策略用来处理这种情况：</p>
<blockquote>
<ol>
<li>noeviction(默认策略)：对于写请求不再提供服务，直接返回错误（DEL请求和部分特殊请求除外）</li>
<li>allkeys-lru：从所有key中，使用LRU算法进行淘汰最近最少使用的数据</li>
<li>allkeys-random：从所有key中，随机选择数据淘汰</li>
<li>volatile-lru：从设置了过期时间的key中，使用LRU算法进行淘汰最近最少使用的数据</li>
<li>volatile-random：从设置了过期时间的key中，随机选择数据淘汰</li>
<li>volatile-ttl：在设置了过期时间的key中，根据key的过期时间进行淘汰，越早过期的越优先被淘汰</li>
</ol>
</blockquote>
<p>注：</p>
<blockquote>
<ul>
<li>当使用volatile-lru、volatile-random、volatile-ttl这三种策略时，如果key没有设置 expire(过期时间)，则和noeviction一样返回错误</li>
<li>将key设置过期时间实际上会消耗更多的内存，因此建议使用allkeys-lru策略从而更有效率的使用内存</li>
</ul>
</blockquote>
<h4 id="配置文件设置"><a href="#配置文件设置" class="headerlink" title="配置文件设置"></a>配置文件设置</h4><p>找到# maxmemory-policy，去掉#注释，在maxmemory-policy后设置淘汰策略，Redis重启后不会失效</p>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/24/ZOPa9UKnzNg1Rxb.png" alt=""></p>
<h4 id="命令修改"><a href="#命令修改" class="headerlink" title="命令修改"></a>命令修改</h4><p>使用redis-cli客户端命令修改，Redis服务重启后将失效</p>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/24/mnVFoqdKxOcgaL4.png" alt=""></p>
<h4 id="LRU算法"><a href="#LRU算法" class="headerlink" title="LRU算法"></a>LRU算法</h4><blockquote>
<p>LRU(Least Recently Used)，即最近最少使用，是一种缓存置换算法。在使用内存作为缓存的时候，缓存的大小一般是固定的。当缓存被占满，这个时候继续往缓存里面添加数据，就需要淘汰一部分老的数据，释放内存空间用来存储新的数据。这个时候就可以使用LRU算法了。<br>核心思想是：如果一个数据在最近一段时间没有被用到，那么将来被使用到的可能性也很小，所以就可以被淘汰掉。</p>
</blockquote>
<h5 id="在Redis中的实现"><a href="#在Redis中的实现" class="headerlink" title="在Redis中的实现"></a>在Redis中的实现</h5><h6 id="近似LRU算法"><a href="#近似LRU算法" class="headerlink" title="近似LRU算法"></a>近似LRU算法</h6><p>Redis使用的是近似LRU算法，它跟常规的LRU算法还不太一样。近似LRU算法通过随机采样法淘汰数据，每次随机出5（默认）个key，从里面淘汰掉最近最少使用的key。</p>
<blockquote>
<p>可以通过maxmemory-samples参数修改采样数量：例：maxmemory-samples 10 maxmenory-samples配置的越大，淘汰的结果越接近于严格的LRU算法</p>
</blockquote>
<p>Redis为了实现近似LRU算法，给每个key增加了一个额外增加了一个24bit的字段，用来存储该key最后一次被访问的时间。</p>
<p><img src= "/img/loading.gif" data-src="https://i.loli.net/2020/08/24/p7uSwkCLXROVaiz.png" alt=""></p>
<h6 id="Redis3-0的优化"><a href="#Redis3-0的优化" class="headerlink" title="Redis3.0的优化"></a>Redis3.0的优化</h6><p>Redis3.0对近似LRU算法进行了一些优化。新算法会维护一个候选池（大小为16），池中的数据根据访问时间进行排序，第一次随机选取的key都会放入池中，随后每次随机选取的key，只有在访问时间小于池中最小的时间才会放入池中，直到候选池被放满。当放满后，如果有新的key需要放入，则将池中最后访问时间最大（最近被访问）的移除。</p>
<p>当需要淘汰的时候，则直接从池中选取最近访问时间最小（最久没被访问）的key淘汰掉就行。</p>
<h4 id="LFU算法"><a href="#LFU算法" class="headerlink" title="LFU算法"></a>LFU算法</h4><p>LFU算法是Redis4.0里面新加的一种淘汰策略。它的全称是Least Frequently Used，它的核心思想是根据key的最近被访问的频率进行淘汰，很少被访问的优先被淘汰，被访问的多的则被留下来。</p>
<p>LFU一共有两种策略：</p>
<blockquote>
<ol>
<li>volatile-lfu：在设置了过期时间的key中，使用LFU算法淘汰key</li>
<li>allkeys-lfu：在所有的key中，使用LFU算法淘汰数据</li>
</ol>
</blockquote>
<p>设置使用这两种淘汰策略跟前面讲的一样，不过要注意的一点是这两种策略只能在Redis4.0及以上设置，如果在Redis4.0以下设置会报错</p>
<h4 id="LRU与LFU的区别"><a href="#LRU与LFU的区别" class="headerlink" title="LRU与LFU的区别"></a>LRU与LFU的区别</h4><p>LFU算法能更好的表示一个key被访问的热度。假如你使用的是LRU算法，一个key很久没有被访问到，只刚刚是偶尔被访问了一次，那么它就被认为是热点数据，不会被淘汰，而有些key将来是很有可能被访问到的则被淘汰了(Redis不直接使用LRU算法的原因)。如果使用LFU算法则不会出现这种情况，因为使用一次并不会使一个key成为热点数据。</p>
<!-- flag of hidden posts --></div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:minkeyto@qq.com">灵熙云</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://www.goitman.cn/2020/08/17/Redis/">http://www.goitman.cn/2020/08/17/Redis/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://www.goitman.cn" target="_blank">灵熙云工作室</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Redis/">Redis</a><a class="post-meta__tags" href="/tags/%E7%BC%93%E5%AD%98/">缓存</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2021/07/01/L2lt73a59Heir8V.jpg" data-sites="wechat,weibo,qq,facebook,twitter"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><button class="reward-button" type="button"><i class="fas fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="/file/wechat.jpg" alt="微信" onclick="window.open('/file/wechat.jpg')"/><div class="post-qr-code__desc">微信</div></li></ul></div></button></div><nav class="pagination-post" id="pagination"></nav><hr><div id="post-comment"><div class="comment-head"><div class="comment-headling"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div class="comments-items-1" data-name="Valine"><div class="vcomment" id="vcomment"></div><script>function loadvaline () {  
  var requestSetting = function (from,set) {
    var from = from
    var setting = set.split(',').filter(function(item){
    return from.indexOf(item) > -1
    });
    setting = setting.length == 0 ? from :setting;
    return setting
  }

  var guestInfo = requestSetting(['nick','mail','link'],'nick,mail,link')
  var requiredFields = requestSetting(['nick','mail'],'nick,mail')

  function initValine () {
    window.valine = new Valine({
      el:'#vcomment',
      appId: 'eKp2wzPKybiFid4KXcVFcyMX-gzGzoHsz',
      appKey: 'RSA7FDJfrFwpawTfG1vE6R71',
      placeholder: 'minkeyto@qq.com',
      avatar: 'monsterid',
      meta: guestInfo,
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      requiredFields: requiredFields
    });
  }
  loadScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js', initValine)
}

if ('Valine' === 'Valine' || false) {
  window.addEventListener('load', loadvaline)
}
else {
  function loadOtherComment () {
    loadvaline()
  }
}</script></div></div></div></article></main><footer id="footer" style="background-image: url(https://i.loli.net/2020/08/17/YiXeMQRwypSL2h9.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2021 By 灵熙云</div><div class="framework-info"><span>Copyright Ⓒ 灵熙云工作室. All rights reserved.</span></div><div class="footer_custom_text">Hi, welcome to my blog !</div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script defer id="ribbon" src="/js/third-party/canvas-ribbon.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script id="ribbon_piao" mobile="false" src="/js/third-party/piao.js"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = false;
POWERMODE.shake = false;
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><script src="/js/search/local-search.js"></script><script>if (document.getElementsByClassName('mermaid').length) {
  loadScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js',function () {
    mermaid.initialize({
      theme: 'default',
  })
})
}</script><script>var endLoading = function () {
  document.body.style.overflow = 'auto';
  document.getElementById('loading-box').classList.add("loaded")
}
window.addEventListener('load',endLoading)</script></body></html>